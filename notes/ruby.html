<!DOCTYPE html>
<html>
<head>
<title>ruby</title>
<!-- 2014-11-20 Thu 10:57 -->
<meta  charset="utf-8">
<meta  name="generator" content="Org-mode">
<meta  name="author" content="Aurélien Bottazini">

<link rel="stylesheet" type="text/css" href="http://aurelienbottazini.com/css/org-export.min.css">
<script src="http://aurelienbottazini.com/js/org-export.min.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">ruby</h1>
<nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. About</a></li>
<li><a href="#sec-2">2. Installation</a></li>
<li><a href="#sec-3">3. Where is it?</a></li>
<li><a href="#sec-4">4. Variables</a>
<ul>
<li><a href="#sec-4-1">4.1. Constants</a></li>
<li><a href="#sec-4-2">4.2. class variables — @@</a></li>
</ul>
</li>
<li><a href="#sec-5">5. Load and Require</a></li>
<li><a href="#sec-6">6. nil ~= false != true</a></li>
<li><a href="#sec-7">7. % sign technique</a></li>
<li><a href="#sec-8">8. Methods</a>
<ul>
<li><a href="#sec-8-1">8.1. ?</a></li>
<li><a href="#sec-8-2">8.2. Arguments</a></li>
<li><a href="#sec-8-3">8.3. Top level methods</a></li>
<li><a href="#sec-8-4">8.4. method look-up summary</a></li>
<li><a href="#sec-8-5">8.5. <code>method_missing</code></a></li>
</ul>
</li>
<li><a href="#sec-9">9. Objects</a>
<ul>
<li><a href="#sec-9-1">9.1. Object behavior</a></li>
<li><a href="#sec-9-2">9.2. Immediate values</a></li>
<li><a href="#sec-9-3">9.3. Freeze, Dup and Clone</a></li>
<li><a href="#sec-9-4">9.4. <code>BasicObject</code>, <code>Object</code> & <code>Kernel</code></a>
<ul>
<li><a href="#sec-9-4-1">9.4.1. Basic Object</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-10">10. Classes</a>
<ul>
<li><a href="#sec-10-1">10.1. initialize</a></li>
<li><a href="#sec-10-2">10.2. <code>super</code></a></li>
<li><a href="#sec-10-3">10.3. attributes</a></li>
<li><a href="#sec-10-4">10.4. assignment-like methods</a></li>
<li><a href="#sec-10-5">10.5. setter methods</a></li>
<li><a href="#sec-10-6">10.6. Subclass</a></li>
<li><a href="#sec-10-7">10.7. Superclass & Modules</a></li>
<li><a href="#sec-10-8">10.8. Methods & Constant notation</a></li>
<li><a href="#sec-10-9">10.9. <code>inspect</code></a></li>
<li><a href="#sec-10-10">10.10. Don’t hard code class names.</a></li>
<li><a href="#sec-10-11">10.11. Instance variables</a></li>
<li><a href="#sec-10-12">10.12. built-in classes</a></li>
<li><a href="#sec-10-13">10.13. public, private, protected</a>
<ul>
<li><a href="#sec-10-13-1">10.13.1. private setter methods</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-11">11. Modules</a>
<ul>
<li><a href="#sec-11-1">11.1. Class and Module naming</a></li>
<li><a href="#sec-11-2">11.2. including a module several times</a></li>
<li><a href="#sec-11-3">11.3. <code>prepend</code></a></li>
<li><a href="#sec-11-4">11.4. Nesting modules and classes</a></li>
</ul>
</li>
<li><a href="#sec-12">12. Self, scope & visibility</a></li>
<li><a href="#sec-13">13. Control-flow techniques</a>
<ul>
<li><a href="#sec-13-1">13.1. if</a></li>
<li><a href="#sec-13-2">13.2. unless</a></li>
<li><a href="#sec-13-3">13.3. case</a></li>
<li><a href="#sec-13-4">13.4. <i><code>=</code></i></a></li>
<li><a href="#sec-13-5">13.5. loop</a></li>
<li><a href="#sec-13-6">13.6. while and until modifiers</a></li>
<li><a href="#sec-13-7">13.7. for</a></li>
<li><a href="#sec-13-8">13.8. curly braces vs do/end code block</a></li>
<li><a href="#sec-13-9">13.9. each and map</a></li>
<li><a href="#sec-13-10">13.10. Block parameters and scope</a></li>
<li><a href="#sec-13-11">13.11. rescue</a></li>
</ul>
</li>
<li><a href="#sec-14">14. Built in essentials</a>
<ul>
<li><a href="#sec-14-1">14.1. Literal constructors</a></li>
<li><a href="#sec-14-2">14.2. Shortcut operators</a></li>
<li><a href="#sec-14-3">14.3. Unary operators</a></li>
<li><a href="#sec-14-4">14.4. <code>dangerous_method!</code></a></li>
<li><a href="#sec-14-5">14.5. conversions</a></li>
<li><a href="#sec-14-6">14.6. Comparisons</a>
<ul>
<li><a href="#sec-14-6-1">14.6.1. Comparable module</a></li>
</ul>
</li>
<li><a href="#sec-14-7">14.7. Inspecting</a></li>
<li><a href="#sec-14-8">14.8. <code>try_convert</code></a></li>
</ul>
</li>
<li><a href="#sec-15">15. Strings</a>
<ul>
<li><a href="#sec-15-1">15.1. String interpolation</a></li>
<li><a href="#sec-15-2">15.2. <i>Here</i> document or <i>here-doc</i></a></li>
<li><a href="#sec-15-3">15.3. Basic string manipulation</a>
<ul>
<li><a href="#sec-15-3-1">15.3.1. Selection</a></li>
<li><a href="#sec-15-3-2">15.3.2. changing strings</a></li>
</ul>
</li>
<li><a href="#sec-15-4">15.4. Enumerable strings</a></li>
<li><a href="#sec-15-5">15.5. Querying strings</a></li>
<li><a href="#sec-15-6">15.6. String comparison</a></li>
<li><a href="#sec-15-7">15.7. transformations</a></li>
<li><a href="#sec-15-8">15.8. Conversions</a></li>
<li><a href="#sec-15-9">15.9. Encoding</a></li>
<li><a href="#sec-15-10">15.10. XOR and strings</a></li>
</ul>
</li>
<li><a href="#sec-16">16. Symbols</a></li>
<li><a href="#sec-17">17. Numerical</a></li>
<li><a href="#sec-18">18. Times and dates</a></li>
<li><a href="#sec-19">19. Collections</a>
<ul>
<li><a href="#sec-19-1">19.1. Array</a>
<ul>
<li><a href="#sec-19-1-1">19.1.1. Inserting, retrieving and removing from an array</a></li>
<li><a href="#sec-19-1-2">19.1.2. Querying</a></li>
</ul>
</li>
<li><a href="#sec-19-2">19.2. Hashes</a>
<ul>
<li><a href="#sec-19-2-1">19.2.1. Hash methods</a></li>
<li><a href="#sec-19-2-2">19.2.2. Querying</a></li>
</ul>
</li>
<li><a href="#sec-19-3">19.3. Ranges</a></li>
<li><a href="#sec-19-4">19.4. Sets</a></li>
</ul>
</li>
<li><a href="#sec-20">20. Enumerable and Enumerator</a>
<ul>
<li><a href="#sec-20-1">20.1. Enumerable</a>
<ul>
<li><a href="#sec-20-1-1">20.1.1. Queries</a></li>
<li><a href="#sec-20-1-2">20.1.2. Search and Select</a></li>
<li><a href="#sec-20-1-3">20.1.3. Element operations:</a></li>
<li><a href="#sec-20-1-4">20.1.4. Each relatives</a></li>
<li><a href="#sec-20-1-5">20.1.5. Sorting</a></li>
</ul>
</li>
<li><a href="#sec-20-2">20.2. Enumerator</a>
<ul>
<li><a href="#sec-20-2-1">20.2.1. creating enumerators</a></li>
<li><a href="#sec-20-2-2">20.2.2. Protecting from change</a></li>
<li><a href="#sec-20-2-3">20.2.3. Slow motion</a></li>
<li><a href="#sec-20-2-4">20.2.4. Adding enumerability with an enumerator</a></li>
<li><a href="#sec-20-2-5">20.2.5. Chaining</a></li>
<li><a href="#sec-20-2-6">20.2.6. Lazy enumerators</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-21">21. Regular Expressions</a>
<ul>
<li><a href="#sec-21-1">21.1. Common methods</a></li>
</ul>
</li>
<li><a href="#sec-22">22. File and I/O operations</a>
<ul>
<li><a href="#sec-22-1">22.1. Reading files</a>
<ul>
<li><a href="#sec-22-1-1">22.1.1. Internal pointer</a></li>
</ul>
</li>
<li><a href="#sec-22-2">22.2. Writing to files</a></li>
<li><a href="#sec-22-3">22.3. File enumerability</a></li>
<li><a href="#sec-22-4">22.4. Querying</a></li>
<li><a href="#sec-22-5">22.5. Directory manipulation</a></li>
<li><a href="#sec-22-6">22.6. <code>FileUtils</code></a></li>
<li><a href="#sec-22-7">22.7. <code>Pathname</code></a></li>
<li><a href="#sec-22-8">22.8. <code>StringIO</code></a></li>
<li><a href="#sec-22-9">22.9. <code>Tempfile</code></a></li>
<li><a href="#sec-22-10">22.10. <code>open-uri</code></a></li>
</ul>
</li>
<li><a href="#sec-23">23. Object individuation</a>
<ul>
<li><a href="#sec-23-1">23.1. Singleton classes</a></li>
<li><a href="#sec-23-2">23.2. Ancestors</a></li>
<li><a href="#sec-23-3">23.3. Alias</a></li>
<li><a href="#sec-23-4">23.4. Modifications</a>
<ul>
<li><a href="#sec-23-4-1">23.4.1. Additive changes</a></li>
<li><a href="#sec-23-4-2">23.4.2. Pass-through overrides</a></li>
<li><a href="#sec-23-4-3">23.4.3. Additive/pass-through hybrids</a></li>
<li><a href="#sec-23-4-4">23.4.4. Extend</a></li>
<li><a href="#sec-23-4-5">23.4.5. Refinements</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-24">24. Callable and runnable object</a>
<ul>
<li><a href="#sec-24-1">24.1. Procs</a></li>
<li><a href="#sec-24-2">24.2. Methods as objects</a></li>
</ul>
</li>
<li><a href="#sec-25">25. Eval</a>
<ul>
<li><a href="#sec-25-1">25.1. <code>instance_eval</code></a></li>
<li><a href="#sec-25-2">25.2. <code>class_eval</code></a></li>
<li><a href="#sec-25-3">25.3. <code>define_method</code></a></li>
</ul>
</li>
<li><a href="#sec-26">26. Threads</a>
<ul>
<li><a href="#sec-26-1">26.1. Example chat server using sockets and threads</a></li>
</ul>
</li>
<li><a href="#sec-27">27. Fibers</a></li>
<li><a href="#sec-28">28. System commands</a>
<ul>
<li><a href="#sec-28-1">28.1. <code>open</code> and <code>open3</code></a></li>
</ul>
</li>
<li><a href="#sec-29">29. Callbacks, hooks and run-time introspection</a>
<ul>
<li><a href="#sec-29-1">29.1. <code>method_missing</code></a></li>
<li><a href="#sec-29-2">29.2. prepend and include</a></li>
<li><a href="#sec-29-3">29.3. extended</a></li>
<li><a href="#sec-29-4">29.4. intercepting inheritance</a></li>
<li><a href="#sec-29-5">29.5. <code>const_missing</code></a></li>
<li><a href="#sec-29-6">29.6. <code>method_added</code></a></li>
<li><a href="#sec-29-7">29.7. listing methods</a></li>
<li><a href="#sec-29-8">29.8. instropection</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> About</h2>
<div class="outline-text-2" id="text-1">
<p>
Ruby version and encoding used for examples:
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-builtin">puts</span> <span class="org-type">RUBY_VERSION</span>
<span class="org-builtin">puts</span> <span class="org-builtin">__ENCODING__</span>
</pre>
</div>

<pre class="example">
2.1.5
UTF-8
</pre>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Installation</h2>
<div class="outline-text-2" id="text-2">
<p>
Make sure you control your Ruby installation and have an up to
date version with <a href="http://rvm.io/">RVM</a> or <a href="https://github.com/sstephenson/rbenv">rbenv</a>.
</p>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Where is it?</h2>
<div class="outline-text-2" id="text-3">
<pre class="example">
$ irb -simple-prompt -rrbconfig
</pre>


<p>
will launch irb and load rbconfig interface which contains a lot
of compiled information about your ruby installation
</p>

<p>
Then you can use <code>RbConfig::CONFIG</code> to get information about your
ruby installation.
</p>

<p>
Notable directories are
</p>

<table>


<colgroup>
<col  class="left">

<col  class="left">
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Term</th>
<th scope="col" class="left">Directory contents</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left"><code>rubylibdir</code></td>
<td class="left">Ruby Standard library</td>
</tr>

<tr>
<td class="left"><code>bindir</code></td>
<td class="left">Ruby command line tools</td>
</tr>

<tr>
<td class="left"><code>archdir</code></td>
<td class="left">Architecture-specific extensions and libraries (compiled binary files)</td>
</tr>

<tr>
<td class="left"><code>sitedir</code></td>
<td class="left">Your own or third party libraries (in Ruby)</td>
</tr>

<tr>
<td class="left"><code>vendordir</code></td>
<td class="left">Third-party extensions and libraries (in Ruby)</td>
</tr>

<tr>
<td class="left"><code>sitelibdir</code></td>
<td class="left">Your own Ruby language extensions  (in Ruby)</td>
</tr>

<tr>
<td class="left"><code>sitearchdir</code></td>
<td class="left">Your own Ruby language extensions (in C)</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Variables</h2>
<div class="outline-text-2" id="text-4">
<table>


<colgroup>
<col  class="left">

<col  class="left">

<col  class="left">
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Type</th>
<th scope="col" class="left">Ruby Convention</th>
<th scope="col" class="left">Non-conventional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">Local</td>
<td class="left"><code>first_name</code></td>
<td class="left"><code>firstName</code>, <code>firstName</code></td>
</tr>

<tr>
<td class="left">Instance</td>
<td class="left"><code>@first_name</code></td>
<td class="left"><code>@FirstName, @firstname</code></td>
</tr>

<tr>
<td class="left">Class</td>
<td class="left"><code>@@first_name</code></td>
<td class="left"><code>@@First_name, @@firstName</code></td>
</tr>

<tr>
<td class="left">Global</td>
<td class="left"><code>$FIRST_NAME</code></td>
<td class="left"><code>$first_name, $firstName</code></td>
</tr>
</tbody>
</table>

<p>
Instance variable are initialized to nil.
</p>
<div class="org-src-container">

<pre class="src src-ruby"><span class="org-variable-name">@var</span>
</pre>
</div>

<pre class="example">
nil
</pre>

<p>
Local variables are not initialized, not even to nil.
</p>
<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">begin</span>
  var
<span class="org-keyword">rescue</span> <span class="org-type">Exception</span> => e
  <span class="org-builtin">puts</span> e.message
<span class="org-keyword">end</span>
</pre>
</div>

<pre class="example">
undefined local variable or method `var' for main:Object
</pre>
</div>

<div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> Constants</h3>
<div class="outline-text-3" id="text-4-1">
<p>
It is possible to perform an assignment on a constant you
already assigned. You will get a warning.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-type">A</span> = 1
<span class="org-type">A</span> = 2
</pre>
</div>

<p>
In the following example, no warning because there is no redefinition of a constant. We
are modifying an array and array has no knowledge it has been
assigned to a constant.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">module</span> <span class="org-type">Earth</span>
  <span class="org-type">COUNTRIES</span> = [<span class="org-string">'Japan'</span>, <span class="org-string">'USA'</span>, <span class="org-string">'China'</span>, <span class="org-string">'Germany'</span>, <span class="org-string">'Italy'</span>]
<span class="org-keyword">end</span>
countries = <span class="org-type">Earth</span>::<span class="org-type">COUNTRIES</span>
countries << <span class="org-string">'France'</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> class variables — @@</h3>
<div class="outline-text-3" id="text-4-2">
<p>
class variables are class-hierarchy scoped.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">class</span> <span class="org-type">Parent</span>
  <span class="org-variable-name">@@value</span> = 100
<span class="org-keyword">end</span>

<span class="org-keyword">class</span> <span class="org-type">Child</span> < <span class="org-type">Parent</span>
  <span class="org-variable-name">@@value</span> = 200
<span class="org-keyword">end</span>

<span class="org-keyword">class</span> <span class="org-type">Parent</span>
  <span class="org-builtin">puts</span> <span class="org-variable-name">@@value</span>
<span class="org-keyword">end</span>
</pre>
</div>

<pre class="example">
200
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Load and Require</h2>
<div class="outline-text-2" id="text-5">
<p>
<code>$:</code> is the load path global variable. You can add directories to load
path. For example <code>~$: << '.'~</code>.
One major difference between <i>load</i> and <i>require</i> if called more
than once with the same arguments is that require doesn’t reload
files it’s already loaded.
</p>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> nil ~= false != true</h2>
<div class="outline-text-2" id="text-6">
<p>
Everything in Ruby has a Boolean value.
<code>nil</code> and <code>false</code> both have a Boolean value of <i>false</i>.
Furthermore <code>true</code>, <code>nil</code> and <code>false</code> are objects.
Note that <code>puts</code> returns nil.
</p>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> % sign technique</h2>
<div class="outline-text-2" id="text-7">
<p>
Allows to use sprintf-like syntax. Run ri sprintf for full documentation.
</p>
<div class="org-src-container">

<pre class="src src-ruby">price = 2.84839849
<span class="org-builtin">p</span> <span class="org-string">"</span><span class="org-variable-name">#{"%.2f" % price}</span><span class="org-string">"</span>
</pre>
</div>

<pre class="example">
2.85
</pre>
</div>
</div>

<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> Methods</h2>
<div class="outline-text-2" id="text-8">
<p>
method definitions evaluates to the symbol <code>:m</code> representing the
name of the method that’s just defined.
</p>
</div>
<div id="outline-container-sec-8-1" class="outline-3">
<h3 id="sec-8-1"><span class="section-number-3">8.1</span> ?</h3>
<div class="outline-text-3" id="text-8-1">
<p>
Use question mark for method names that evaluate to <code>true</code> or <code>false</code>.
</p>
</div>
</div>

<div id="outline-container-sec-8-2" class="outline-3">
<h3 id="sec-8-2"><span class="section-number-3">8.2</span> Arguments</h3>
<div class="outline-text-3" id="text-8-2">
<p>
<code>*</code> allows any number of arguments and <i>sponges</i> arguments if
placed between other arguments.
Use <code>=</code> to supply a default value for arguments.
</p>

<table>


<colgroup>
<col  class="left">

<col  class="left">

<col  class="left">
</colgroup>
<thead>
<tr>
<th scope="col" class="left">method signature</th>
<th scope="col" class="left">sample call(s)</th>
<th scope="col" class="left">variable assignments</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left"><code>def m(*a)</code></td>
<td class="left"><code>m(1,2,3)</code></td>
<td class="left"><code>a = [1,2,3]</code></td>
</tr>

<tr>
<td class="left"><code>def m(a, b=1)</code></td>
<td class="left"><code>m(2)</code></td>
<td class="left"><code>a = 2, b = 1</code></td>
</tr>

<tr>
<td class="left"> </td>
<td class="left"><code>m(2,3)</code></td>
<td class="left"><code>a = 2, b = 3</code></td>
</tr>

<tr>
<td class="left"><code>def m(a, b = 2, *c, d)</code></td>
<td class="left"><code>m(1, 3)</code></td>
<td class="left"><code>a = 1, b = 2, c = [], d = 3</code></td>
</tr>

<tr>
<td class="left"> </td>
<td class="left"><code>m(1, 3, 5, 7)</code></td>
<td class="left"><code>a = 1, b = 3, c = [5], d = 7</code></td>
</tr>

<tr>
<td class="left"> </td>
<td class="left"><code>m(1, 3, 5, 7, 9)</code></td>
<td class="left"><code>a = 1, b = 3, c = [5, 7], d = 9</code></td>
</tr>

<tr>
<td class="left"><code>def m(a:, b:)</code></td>
<td class="left"><code>m(a:1, b:2)</code></td>
<td class="left"><code>a = 1, b = 2</code></td>
</tr>

<tr>
<td class="left"><code>def m(a: 1, b: 2)</code></td>
<td class="left"><code>m</code></td>
<td class="left"><code>a = 1, b = 2</code></td>
</tr>

<tr>
<td class="left"> </td>
<td class="left"><code>m(3, 4)</code></td>
<td class="left"><code>a = 3, b = 4</code></td>
</tr>

<tr>
<td class="left"><code>def m(x, y, *z, a:1, b:, **c, &block)</code></td>
<td class="left"><code>m(1,2,3,4,5,b:10,p:20,q:30)</code></td>
<td class="left"><code>x = 1, y= 2, z=[3,4,5], a = 1, b = 10, c = {:p => 20, :q => 30}</code></td>
</tr>

<tr>
<td class="left">c here absorbs unknown named arguments</td>
<td class="left"> </td>
<td class="left"> </td>
</tr>
</tbody>
</table>

<p>
When using <code>Hashes</code> as arguments. If it is the last argument you
can write it without curly braces
</p>

<div class="org-src-container">

<pre class="src src-ruby">add_to_database(<span class="org-string">'Lille'</span>, <span class="org-constant">country</span>: <span class="org-string">'France'</span>, <span class="org-constant">postal_code</span>: 62000)
</pre>
</div>

<p>
If it is the first argument you must use parentheses (or ruby
will think it is a block) and curly braces
</p>

<div class="org-src-container">

<pre class="src src-ruby">add_to_database({country => <span class="org-string">'France'</span>, postal_code => 62000}, <span class="org-string">'Lille'</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-8-3" class="outline-3">
<h3 id="sec-8-3"><span class="section-number-3">8.3</span> Top level methods</h3>
<div class="outline-text-3" id="text-8-3">
<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">def</span> <span class="org-function-name">talk</span>
  <span class="org-builtin">puts</span> <span class="org-string">'hello'</span>
<span class="org-keyword">end</span>
</pre>
</div>

<p>
is equivalent to
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">class</span> <span class="org-type">Object</span>
  <span class="org-builtin">private</span>
  <span class="org-keyword">def</span> <span class="org-function-name">talk</span>
    <span class="org-builtin">puts</span> <span class="org-string">'hello'</span>
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-8-4" class="outline-3">
<h3 id="sec-8-4"><span class="section-number-3">8.4</span> method look-up summary</h3>
<div class="outline-text-3" id="text-8-4">
<p>
To look for a method, an object looks in:
</p>

<ol class="org-ol">
<li>Modules pre-pended
</li>
<li>singleton class
</li>
<li>It’s class
</li>
<li>Modules in it class
</li>
<li>Modules pre-pended to its superclass
</li>
<li>It’s class superclass
</li>
<li>Modules included in its superclass
</li>
<li>and so on up to <code>BasicObject</code>
</li>
</ol>

<p>
A method defined as a singleton method of a class object can
also be called on sub-classes of that class. The singleton
class is considered the ancestor of the singleton class of
sub-classes.
</p>
</div>
</div>

<div id="outline-container-sec-8-5" class="outline-3">
<h3 id="sec-8-5"><span class="section-number-3">8.5</span> <code>method_missing</code></h3>
<div class="outline-text-3" id="text-8-5">
<p>
Get called as a last resort for unmatched messages. You can
override <code>method_missing</code>
</p>

<p>
A good example of a <code>method_missing</code> override:
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">class</span> <span class="org-type">Person</span>
  <span class="org-keyword">def</span> <span class="org-variable-name">self</span>.<span class="org-function-name">method_missing</span>(m, *args)
    method = m.to_s
    <span class="org-keyword">if</span> method.start_with?(<span class="org-string">'all_with_'</span>)
    <span class="org-comment-delimiter"># </span><span class="org-comment">Handle request here"</span>
    <span class="org-keyword">else</span>
      <span class="org-keyword">super</span>
    <span class="org-keyword">end</span>
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> Objects</h2>
<div class="outline-text-2" id="text-9">
<p>
Everything you handle in Ruby is either an object or a construct
that evaluates to an object.
</p>
</div>

<div id="outline-container-sec-9-1" class="outline-3">
<h3 id="sec-9-1"><span class="section-number-3">9.1</span> Object behavior</h3>
<div class="outline-text-3" id="text-9-1">
<p>
3 very useful and common functions
</p>
<ul class="org-ul">
<li><code>object_id</code>
</li>
<li><code>respond_to?</code>
</li>
<li><code>send</code> (you can use <code>__send__</code> if you want to
make sure you use Ruby’s built in method send)
</li>
</ul>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">if</span> object.respond_to?(request)
  <span class="org-builtin">puts</span> ticket.send(request)
<span class="org-keyword">end</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-9-2" class="outline-3">
<h3 id="sec-9-2"><span class="section-number-3">9.2</span> Immediate values</h3>
<div class="outline-text-3" id="text-9-2">
<p>
Some objects like <i>Integers</i>, <i>symbols</i> and <code>true</code>, <code>false</code>,
<code>nil</code> are stored in variables as immediate value. The variable
holds the value itself rather than a reference to it.
</p>

<p>
It follows that there is only one object <code>1</code>, only one <code>true</code>.
And that’s why there is no <code>++</code> operator in ruby. Because <code>1++</code>
means you would be changing the number 1 to 2 and that makes no
sense.
</p>
</div>
</div>

<div id="outline-container-sec-9-3" class="outline-3">
<h3 id="sec-9-3"><span class="section-number-3">9.3</span> Freeze, Dup and Clone</h3>
<div class="outline-text-3" id="text-9-3">
<p>
You can freeze an object ruby to prevent and object from
undergoing further changes.
</p>

<p>
<code>dup</code> duplicates an object. <code>clone</code> duplicate an object and if
the cloned object was frozen, the clone is also frozen.
</p>
</div>
</div>

<div id="outline-container-sec-9-4" class="outline-3">
<h3 id="sec-9-4"><span class="section-number-3">9.4</span> <code>BasicObject</code>, <code>Object</code> & <code>Kernel</code></h3>
<div class="outline-text-3" id="text-9-4">
<p>
<code>BasicObject</code> comes before <code>Object</code> in the ruby family tree.
<code>BasicObject</code> offers a blank state object. an object with
almost no methods.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-builtin">puts</span> <span class="org-type">BasicObject</span>.instance_methods.count
<span class="org-builtin">puts</span> <span class="org-type">Object</span>.instance_methods.count
</pre>
</div>

<pre class="example">
8
55
</pre>

<p>
<code>Kernel</code> module contains the majority of the methods common to
all objects
</p>

<p>
<code>BasicObject</code>, <code>Object</code> & <code>Kernel</code> are written in C. Here is a
Ruby mock-up of their relationship
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">class</span> <span class="org-type">BasicObject</span>
  <span class="org-comment-delimiter"># </span><span class="org-comment">few methods</span>
<span class="org-keyword">end</span>
<span class="org-keyword">module</span> <span class="org-type">Kernel</span>
  <span class="org-comment-delimiter"># </span><span class="org-comment">a lot of method definitions</span>
<span class="org-keyword">end</span>
<span class="org-keyword">class</span> <span class="org-type">Object</span> < <span class="org-type">BasicObject</span>
  <span class="org-builtin">include</span> <span class="org-type">Kernel</span>
<span class="org-keyword">end</span>
</pre>
</div>
</div>
<div id="outline-container-sec-9-4-1" class="outline-4">
<h4 id="sec-9-4-1"><span class="section-number-4">9.4.1</span> Basic Object</h4>
<div class="outline-text-4" id="text-9-4-1">
<p>
For any object: <code>obj.class.ancestors.last == BasicObject</code>.
</p>

<p>
<code>BasicObject</code> allows you to create objects that do nothing.
Which means you can teach them everything without worrying about
clashing with existing methods.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-10" class="outline-2">
<h2 id="sec-10"><span class="section-number-2">10</span> Classes</h2>
<div class="outline-text-2" id="text-10">
<p>
Every object is an instance of some class.
</p>

<p>
Class definitions evaluates to the last expression contained
inside it, or <code>nil</code> if the block is empty.
</p>
</div>

<div id="outline-container-sec-10-1" class="outline-3">
<h3 id="sec-10-1"><span class="section-number-3">10.1</span> initialize</h3>
<div class="outline-text-3" id="text-10-1">
<p>
Arguments used with <code>new</code> are automatically sent to <code>initialize</code>.
</p>
</div>
</div>

<div id="outline-container-sec-10-2" class="outline-3">
<h3 id="sec-10-2"><span class="section-number-3">10.2</span> <code>super</code></h3>
<div class="outline-text-3" id="text-10-2">
<ul class="org-ul">
<li>Called with no arguments, <code>super</code> automatically forwards
arguments passed to the method from which it’s called.
</li>
<li>with an empty argument list <code>super()</code> sends no
argument.
</li>
<li>called with specific arguments <code>super(a, b, c)</code> sends those
arguments.
</li>
</ul>
</div>
</div>


<div id="outline-container-sec-10-3" class="outline-3">
<h3 id="sec-10-3"><span class="section-number-3">10.3</span> attributes</h3>
<div class="outline-text-3" id="text-10-3">
<table>


<colgroup>
<col  class="left">

<col  class="left">

<col  class="left">

<col  class="left">
</colgroup>
<tbody>
<tr>
<td class="left">method name</td>
<td class="left">effect</td>
<td class="left">example</td>
<td class="left">equivalent code</td>
</tr>

<tr>
<td class="left"><code>attr_reader</code></td>
<td class="left">creates a read method</td>
<td class="left"><code>attr_reader :venue</code></td>
<td class="left">def venue</td>
</tr>

<tr>
<td class="left"> </td>
<td class="left"> </td>
<td class="left"> </td>
<td class="left">@venue</td>
</tr>

<tr>
<td class="left"> </td>
<td class="left"> </td>
<td class="left"> </td>
<td class="left">end</td>
</tr>

<tr>
<td class="left"><code>attr_writer</code></td>
<td class="left">creates a writer method</td>
<td class="left"><code>attr_writer :price</code></td>
<td class="left">def price=(price)</td>
</tr>

<tr>
<td class="left"> </td>
<td class="left"> </td>
<td class="left"> </td>
<td class="left">@price = price</td>
</tr>

<tr>
<td class="left"> </td>
<td class="left"> </td>
<td class="left"> </td>
<td class="left">end</td>
</tr>

<tr>
<td class="left"><code>attr_accessor</code></td>
<td class="left">creates reader and writer method</td>
<td class="left"><code>attr_accessor :price</code></td>
<td class="left"> </td>
</tr>

<tr>
<td class="left"><code>attr</code></td>
<td class="left">creates a reader method</td>
<td class="left"><code>attr :venue</code></td>
<td class="left"> </td>
</tr>

<tr>
<td class="left"> </td>
<td class="left">and a writer method if the second argument is true</td>
<td class="left"><code>attr :price, true</code></td>
<td class="left"> </td>
</tr>
</tbody>
</table>

<p>
Those family methods are defined in <i>Module</i>
</p>
</div>
</div>
<div id="outline-container-sec-10-4" class="outline-3">
<h3 id="sec-10-4"><span class="section-number-3">10.4</span> assignment-like methods</h3>
<div class="outline-text-3" id="text-10-4">
<div class="org-src-container">

<pre class="src src-ruby">ticket.price=(63.00)
ticket.price = 63.00
</pre>
</div>

<p>
The second version is syntactic sugar for the first one. It is
important to understand and remember. <code>=</code> is a method (like
other operators) and can be overloaded.
</p>
</div>
</div>

<div id="outline-container-sec-10-5" class="outline-3">
<h3 id="sec-10-5"><span class="section-number-3">10.5</span> setter methods</h3>
<div class="outline-text-3" id="text-10-5">
<p>
They behave like assignment. They return the value of the
expression rather than the last expression evaluated during
execution.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">class</span> <span class="org-type">Ticket</span>
  <span class="org-keyword">def</span> <span class="org-function-name">price=</span>(price)
    <span class="org-variable-name">@price</span> = price
    <span class="org-keyword">return</span> <span class="org-string">'ahah'</span>
  <span class="org-keyword">end</span>

<span class="org-keyword">end</span>

<span class="org-keyword">if</span> (<span class="org-type">Ticket</span>.new.price = 65) == 65
  <span class="org-builtin">puts</span> <span class="org-string">'my return value is 65'</span>
<span class="org-keyword">end</span>
</pre>
</div>

<pre class="example">
my return value is 65
</pre>
</div>
</div>

<div id="outline-container-sec-10-6" class="outline-3">
<h3 id="sec-10-6"><span class="section-number-3">10.6</span> Subclass</h3>
<div class="outline-text-3" id="text-10-6">
<p>
<code><</code> designates a subclass.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">class</span> <span class="org-type">Publication</span>
<span class="org-keyword">end</span>

<span class="org-keyword">class</span> <span class="org-type">Magazine</span> < <span class="org-type">Publication</span>
<span class="org-keyword">end</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-10-7" class="outline-3">
<h3 id="sec-10-7"><span class="section-number-3">10.7</span> Superclass & Modules</h3>
<div class="outline-text-3" id="text-10-7">
<p>
A Ruby <i>class</i> can have only one <i>superclass</i> (<i>single
inheritance</i>).
Ruby provides modules that you can <i>mix in</i> your class’s family
tree to provide as many methods for your objects as you need.
</p>
</div>
</div>

<div id="outline-container-sec-10-8" class="outline-3">
<h3 id="sec-10-8"><span class="section-number-3">10.8</span> Methods & Constant notation</h3>
<div class="outline-text-3" id="text-10-8">
<ul class="org-ul">
<li><code>Ticket#price</code>: instance method <code>price</code> in the <i>class</i>
     <code>Ticket</code>
</li>
<li><code>Ticket.most_expensive</code>: <i>class</i> method <code>most_expensive</code> in
the class Ticket
</li>
<li><code>Ticket::most_expensive</code>: <i>class</i> method <code>most_expensive</code> in
the class Ticket
</li>
<li><code>Ticket::VENUES</code>: constant <code>VENUES</code> in class <code>Ticket</code>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-10-9" class="outline-3">
<h3 id="sec-10-9"><span class="section-number-3">10.9</span> <code>inspect</code></h3>
<div class="outline-text-3" id="text-10-9">
<p>
You can override it and have useful info about your custom
class.
</p>
</div>
</div>
<div id="outline-container-sec-10-10" class="outline-3">
<h3 id="sec-10-10"><span class="section-number-3">10.10</span> Don’t hard code class names.</h3>
<div class="outline-text-3" id="text-10-10">
<p>
It is bad in case you want to rename  your class. Instead use self
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">class</span> <span class="org-type">C</span>
  <span class="org-keyword">def</span> <span class="org-type">C</span>.<span class="org-function-name">y</span> <span class="org-comment-delimiter"># </span><span class="org-comment">bad</span>
  <span class="org-keyword">end</span>

  <span class="org-keyword">def</span> <span class="org-variable-name">self</span>.<span class="org-function-name">x</span> <span class="org-comment-delimiter"># </span><span class="org-comment">good</span>
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-10-11" class="outline-3">
<h3 id="sec-10-11"><span class="section-number-3">10.11</span> Instance variables</h3>
<div class="outline-text-3" id="text-10-11">
<p>
every instance variable belongs to whatever object is the
current object (/self) at that point.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">class</span> <span class="org-type">C</span>
  <span class="org-builtin">p</span> <span class="org-variable-name">self</span>
  <span class="org-variable-name">@v</span> = <span class="org-string">"top level instance variable "</span>
  <span class="org-builtin">p</span> <span class="org-variable-name">@v</span>

  <span class="org-keyword">def</span> <span class="org-function-name">show_v</span>
    <span class="org-builtin">p</span> <span class="org-variable-name">self</span>
    <span class="org-builtin">p</span> <span class="org-variable-name">@v</span>
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>

c = <span class="org-type">C</span>.new
c.show_v
</pre>
</div>

<pre class="example">
C
"top level instance variable "
#<C:0x007f882b9fd9f8>
nil
</pre>

<p>
The two variables <code>@v</code> are different
</p>
</div>
</div>

<div id="outline-container-sec-10-12" class="outline-3">
<h3 id="sec-10-12"><span class="section-number-3">10.12</span> built-in classes</h3>
<div class="outline-text-3" id="text-10-12">
<p>
You can create you own <i>string</i> class
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">class</span> <span class="org-type">MyClass</span>
  <span class="org-keyword">class</span> <span class="org-type">String</span>

  <span class="org-keyword">end</span>
  <span class="org-keyword">def</span> <span class="org-function-name">initialize</span>
    <span class="org-type">String</span>.new
  <span class="org-keyword">end</span>
</pre>
</div>

<p>
Here the <code>String</code> used will be the new one defined in
<code>MyClass</code>. To use the build in Ruby <code>String</code> you can use <code>::String.new</code>.
<code>::</code> in front of a constant means start the search for this at
the top level.
</p>
</div>
</div>

<div id="outline-container-sec-10-13" class="outline-3">
<h3 id="sec-10-13"><span class="section-number-3">10.13</span> public, private, protected</h3>
<div class="outline-text-3" id="text-10-13">
<p>
you either do
<code>private :first_method, :second_method, :third_method</code>. To make
those three methods private. Or Use <code>private</code> as a switch
without arguments then ll methods below <code>private</code> in your class
will be private.
</p>
</div>

<div id="outline-container-sec-10-13-1" class="outline-4">
<h4 id="sec-10-13-1"><span class="section-number-4">10.13.1</span> private setter methods</h4>
<div class="outline-text-4" id="text-10-13-1">
<p>
you can omit <code>self</code> when defining private access. It won’t
clash with an hypothetic class variable. Ruby is smart enough
to understand what you mean.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">class</span> <span class="org-type">Dog</span>
  <span class="org-builtin">attr_reader</span> <span class="org-constant">:age</span>, <span class="org-constant">:dog_years</span>
  <span class="org-keyword">def</span> <span class="org-function-name">dog_years=</span>(years)
    <span class="org-variable-name">@dog_years</span> = years
  <span class="org-keyword">end</span>
  <span class="org-keyword">def</span> <span class="org-function-name">age=</span>(years)
    <span class="org-variable-name">@age</span> = years
    <span class="org-variable-name">self</span>.dog_years = years * 7 <span class="org-comment-delimiter"># </span><span class="org-comment">= @dog_years = years * 7</span>
  <span class="org-keyword">end</span>
  <span class="org-builtin">private</span> <span class="org-constant">:dog_years=</span>
<span class="org-keyword">end</span>

luigi = <span class="org-type">Dog</span>.new
luigi.age = 10
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-11" class="outline-2">
<h2 id="sec-11"><span class="section-number-2">11</span> Modules</h2>
<div class="outline-text-2" id="text-11">
<p>
Modules don’t have instances. It follows that entities or things
are best modeled in classes and characteristics or properties
are best encapsulated in modules.
</p>

<p>
The <i>class</i> of <code>Class</code> and <code>Module</code> is <i>class</i>. The <i>superclass</i> of
<code>Class</code> is <code>Module</code>. The <i>superclass</i> of <code>Module</code> is object.
</p>

<p>
modules get <i>mixed in</i> to classes using <code>include</code> or <code>prepend</code>.
A <i>mixed in</i> module is referred as a <i>mix in</i>.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">class</span> <span class="org-type">ModuleTester</span>
  <span class="org-builtin">include</span> <span class="org-type">MyFirstModule</span>
<span class="org-keyword">end</span>
</pre>
</div>

<p>
The main difference between inheriting from a <i>class</i> and
<i>modules</i> is that you can <i>mix in</i> more that one module
</p>
</div>

<div id="outline-container-sec-11-1" class="outline-3">
<h3 id="sec-11-1"><span class="section-number-3">11.1</span> Class and Module naming</h3>
<div class="outline-text-3" id="text-11-1">
<p>
It is common to have /class/’s name as noun and /module/’s as an adjective
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">class</span> <span class="org-type">Stack</span>
  <span class="org-builtin">include</span> <span class="org-type">Stacklike</span>
<span class="org-keyword">end</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-11-2" class="outline-3">
<h3 id="sec-11-2"><span class="section-number-3">11.2</span> including a module several times</h3>
<div class="outline-text-3" id="text-11-2">
<p>
Re-including a <i>module</i> does not do anything as the module is
already in the search path. In the following example, if <i>N</i> and
<i>M</i> have some methods with the same name, the method defined in
<i>N</i> will be called.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">class</span> <span class="org-type">C</span>
  <span class="org-builtin">include</span> <span class="org-type">M</span>
  <span class="org-builtin">include</span> <span class="org-type">N</span>
  <span class="org-builtin">include</span> <span class="org-type">M</span>
<span class="org-keyword">end</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-11-3" class="outline-3">
<h3 id="sec-11-3"><span class="section-number-3">11.3</span> <code>prepend</code></h3>
<div class="outline-text-3" id="text-11-3">
<p>
<code>prepend</code> appeared with Ruby 2. The difference between
<code>include</code> and <code>prepend</code> is that when you <code>prepend a module</code>,
the object looks in the module first instead of looking in the
class.
</p>
</div>
</div>

<div id="outline-container-sec-11-4" class="outline-3">
<h3 id="sec-11-4"><span class="section-number-3">11.4</span> Nesting modules and classes</h3>
<div class="outline-text-3" id="text-11-4">
<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">module</span> <span class="org-type">Tools</span>
  <span class="org-keyword">class</span> <span class="org-type">Hammer</span>
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>
</pre>
</div>

<p>
Used to separate name-spaces for classes, modules and methods.
However if you see a construct like <code>Tools::Hammer</code> you can’t
say from that construct if <code>Hammer</code> is a class or a module. You
know it through the documentation or because you wrote the
code. The notation in itself does not tell you everything.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-12" class="outline-2">
<h2 id="sec-12"><span class="section-number-2">12</span> Self, scope & visibility</h2>
<div class="outline-text-2" id="text-12">
<table>


<colgroup>
<col  class="left">

<col  class="left">

<col  class="left">
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Context</th>
<th scope="col" class="left">Example</th>
<th scope="col" class="left">Which object is self?</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">Top level of program</td>
<td class="left">Any code</td>
<td class="left"><code>main</code></td>
</tr>

<tr>
<td class="left">Class definition</td>
<td class="left">class C</td>
<td class="left">class object C</td>
</tr>

<tr>
<td class="left"> </td>
<td class="left">self</td>
<td class="left"> </td>
</tr>

<tr>
<td class="left">Module definition</td>
<td class="left">module M</td>
<td class="left">module object M</td>
</tr>

<tr>
<td class="left"> </td>
<td class="left">self</td>
<td class="left"> </td>
</tr>

<tr>
<td class="left">Method definitions</td>
<td class="left">1. Top level</td>
<td class="left">whatever object is self</td>
</tr>

<tr>
<td class="left"> </td>
<td class="left">def method<sub>name</sub></td>
<td class="left">when the method is called</td>
</tr>

<tr>
<td class="left"> </td>
<td class="left">self</td>
<td class="left"> </td>
</tr>

<tr>
<td class="left"> </td>
<td class="left">2. class instance-method</td>
<td class="left">An instance of C</td>
</tr>

<tr>
<td class="left"> </td>
<td class="left">class C</td>
<td class="left"> </td>
</tr>

<tr>
<td class="left"> </td>
<td class="left">def method<sub>name</sub></td>
<td class="left"> </td>
</tr>

<tr>
<td class="left"> </td>
<td class="left">self</td>
<td class="left"> </td>
</tr>

<tr>
<td class="left"> </td>
<td class="left">3. module instance-method</td>
<td class="left">- Individual object extended by M</td>
</tr>

<tr>
<td class="left"> </td>
<td class="left">module M</td>
<td class="left">- Instance of class that mixes in M</td>
</tr>

<tr>
<td class="left"> </td>
<td class="left">def method<sub>name</sub></td>
<td class="left"> </td>
</tr>

<tr>
<td class="left"> </td>
<td class="left">self</td>
<td class="left"> </td>
</tr>

<tr>
<td class="left"> </td>
<td class="left">4. Singleton method on an object</td>
<td class="left">Obj</td>
</tr>

<tr>
<td class="left"> </td>
<td class="left">def obj.method<sub>name</sub></td>
<td class="left"> </td>
</tr>

<tr>
<td class="left"> </td>
<td class="left">self</td>
<td class="left"> </td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-13" class="outline-2">
<h2 id="sec-13"><span class="section-number-2">13</span> Control-flow techniques</h2>
<div class="outline-text-2" id="text-13">
</div><div id="outline-container-sec-13-1" class="outline-3">
<h3 id="sec-13-1"><span class="section-number-3">13.1</span> if</h3>
<div class="outline-text-3" id="text-13-1">
<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">if</span> x > 10
  <span class="org-builtin">puts</span> x
<span class="org-keyword">end</span>

<span class="org-keyword">if</span> x > 10 <span class="org-keyword">then</span> <span class="org-builtin">puts</span> x <span class="org-keyword">end</span>

<span class="org-keyword">if</span> x > 10; <span class="org-builtin">puts</span> x; <span class="org-keyword">end</span>

<span class="org-builtin">puts</span> x <span class="org-keyword">if</span> x > 10
</pre>
</div>

<p>
If an <code>if</code> statement does not succeed it returns <code>nil</code>
It it succeeds the entire statement evaluates to whatever is
represented by the code in the successful branch.
</p>
</div>
</div>

<div id="outline-container-sec-13-2" class="outline-3">
<h3 id="sec-13-2"><span class="section-number-3">13.2</span> unless</h3>
<div class="outline-text-3" id="text-13-2">
<p>
same as <code>if not</code> or <code>if!</code>
</p>
</div>
</div>

<div id="outline-container-sec-13-3" class="outline-3">
<h3 id="sec-13-3"><span class="section-number-3">13.3</span> case</h3>
<div class="outline-text-3" id="text-13-3">
<p>
At most one match will succeed and have its code executed.
You can put more than one possible match in a single <code>when</code>
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">case</span> answer
<span class="org-keyword">when</span> <span class="org-string">'y'</span>, <span class="org-string">'yes'</span>
  <span class="org-builtin">puts</span> <span class="org-string">'affirmative!'</span>
<span class="org-keyword">when</span> <span class="org-string">'n'</span>, <span class="org-string">'no'</span>
  <span class="org-builtin">puts</span> <span class="org-string">'negative!'</span>
<span class="org-keyword">else</span>
  <span class="org-builtin">puts</span> <span class="org-string">'not sure'</span>
<span class="org-keyword">end</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-13-4" class="outline-3">
<h3 id="sec-13-4"><span class="section-number-3">13.4</span> <i><code>=</code></i></h3>
<div class="outline-text-3" id="text-13-4">
<p>
For <code>String</code> and any object that does not override it, <code>===</code>
works the same as <code>==</code>. Every class can define its own <code>===</code>
method. It is used in <i>case when</i> equality logic.
</p>
</div>
</div>

<div id="outline-container-sec-13-5" class="outline-3">
<h3 id="sec-13-5"><span class="section-number-3">13.5</span> loop</h3>
<div class="outline-text-3" id="text-13-5">
<p>
loop is an iterator. In Ruby an iterator is a method that
expects you to provide a code block.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-builtin">loop</span> { <span class="org-builtin">puts</span> <span class="org-string">'looping forever'</span> }
</pre>
</div>

<div class="org-src-container">

<pre class="src src-ruby">n = 1
<span class="org-builtin">loop</span> <span class="org-keyword">do</span>
  n += 1
  <span class="org-keyword">next</span> <span class="org-keyword">unless</span> n == 10
  <span class="org-keyword">break</span>
<span class="org-keyword">end</span>
</pre>
</div>

<p>
Here is how we can write loop
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">def</span> <span class="org-function-name">my_loop</span>
  <span class="org-keyword">yield</span> <span class="org-keyword">while</span> <span class="org-variable-name">true</span>
<span class="org-keyword">end</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-13-6" class="outline-3">
<h3 id="sec-13-6"><span class="section-number-3">13.6</span> while and until modifiers</h3>
<div class="outline-text-3" id="text-13-6">
<div class="org-src-container">

<pre class="src src-ruby">n += 1 <span class="org-keyword">until</span> n == 10
n += 1 <span class="org-keyword">while</span> n < 10
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-13-7" class="outline-3">
<h3 id="sec-13-7"><span class="section-number-3">13.7</span> for</h3>
<div class="outline-text-3" id="text-13-7">
<div class="org-src-container">

<pre class="src src-ruby">numbers = [0, 10, 20, 30, 40, 50]
<span class="org-keyword">for</span> n <span class="org-keyword">in</span> numbers
  <span class="org-builtin">puts</span> n
<span class="org-keyword">end</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-13-8" class="outline-3">
<h3 id="sec-13-8"><span class="section-number-3">13.8</span> curly braces vs do/end code block</h3>
<div class="outline-text-3" id="text-13-8">
<p>
The difference between the two is a difference in precedence
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-builtin">puts</span> [1, 2, 3].map { |n| n * 10 }
<span class="org-comment-delimiter"># </span><span class="org-comment">is like</span>
<span class="org-builtin">puts</span> ([1, 2, 3].map { |n| n * 10 })
</pre>
</div>
<p>
will output 10, 20 , 30
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-builtin">puts</span> [1, 2, 3].map <span class="org-keyword">do</span> |n| n * 10 <span class="org-keyword">end</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">is like</span>
<span class="org-builtin">puts</span> ([1, 2, 3].map) <span class="org-keyword">do</span> |n| n * 10 <span class="org-keyword">end</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">is like</span>
<span class="org-builtin">puts</span> [1, 2, 3].map
</pre>
</div>
<p>
will output an enumerator
</p>
</div>
</div>

<div id="outline-container-sec-13-9" class="outline-3">
<h3 id="sec-13-9"><span class="section-number-3">13.9</span> each and map</h3>
<div class="outline-text-3" id="text-13-9">
<ul class="org-ul">
<li><code>each</code> returns its receiver
</li>
<li><code>map</code> returns a new array
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-13-10" class="outline-3">
<h3 id="sec-13-10"><span class="section-number-3">13.10</span> Block parameters and scope</h3>
<div class="outline-text-3" id="text-13-10">
<p>
If you have a variable of a given name in scope and also use
that name as one of your block parameters, then the two
variables are not the same as each other.
You can use this to your advantage to make sure a temporary
variable inside a block does not reuse a variable from outside
the block
</p>

<div class="org-src-container">

<pre class="src src-ruby">x = <span class="org-string">"original x"</span>
3.times <span class="org-keyword">do</span> |i;x|
  x = i
<span class="org-keyword">end</span>
x
</pre>
</div>

<p>
<code>;</code> indicates the block needs its own x.
</p>
</div>
</div>

<div id="outline-container-sec-13-11" class="outline-3">
<h3 id="sec-13-11"><span class="section-number-3">13.11</span> rescue</h3>
<div class="outline-text-3" id="text-13-11">
<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">begin</span>
  <span class="org-comment-delimiter">#</span><span class="org-comment">some code</span>
<span class="org-keyword">rescue</span> <span class="org-type">ArgumentError</span> => e
<span class="org-comment-delimiter">#</span><span class="org-comment">rescue code</span>
  <span class="org-builtin">puts</span> e.backtrace
  <span class="org-builtin">puts</span> e.message
<span class="org-keyword">ensure</span>
  <span class="org-comment-delimiter">#</span><span class="org-comment">make sure this runs</span>
<span class="org-keyword">end</span>
</pre>
</div>

<p>
if you put rescue at the end of a method you don’t need to say
begin explicitly. Rescue will govern the entire method block
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">def</span> <span class="org-function-name">method_name</span>
  <span class="org-builtin">puts</span> <span class="org-string">'hello'</span>
  <span class="org-keyword">rescue</span>
  <span class="org-builtin">puts</span> <span class="org-string">'rescued'</span>
<span class="org-keyword">end</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-14" class="outline-2">
<h2 id="sec-14"><span class="section-number-2">14</span> Built in essentials</h2>
<div class="outline-text-2" id="text-14">
</div><div id="outline-container-sec-14-1" class="outline-3">
<h3 id="sec-14-1"><span class="section-number-3">14.1</span> Literal constructors</h3>
<div class="outline-text-3" id="text-14-1">
<p>
Special notation instead of a call to <code>new</code> to create a new
object of that class.
</p>

<table>


<colgroup>
<col  class="left">

<col  class="left">
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Class</th>
<th scope="col" class="left">Examples(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">String</td>
<td class="left">"Hello"</td>
</tr>

<tr>
<td class="left"> </td>
<td class="left">'hello'</td>
</tr>

<tr>
<td class="left">Symbol</td>
<td class="left">:hello</td>
</tr>

<tr>
<td class="left">Array</td>
<td class="left">[1, 2, 3, 4]</td>
</tr>

<tr>
<td class="left">Hash</td>
<td class="left">{ 'Hello' -> 'Bonjour' }</td>
</tr>

<tr>
<td class="left">Range</td>
<td class="left">0..9</td>
</tr>

<tr>
<td class="left"> </td>
<td class="left">0…10</td>
</tr>

<tr>
<td class="left">Regexp</td>
<td class="left"><i>([a-z]+)</i></td>
</tr>

<tr>
<td class="left">Proc (lambda)</td>
<td class="left">->(x, y) { x * y }</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-14-2" class="outline-3">
<h3 id="sec-14-2"><span class="section-number-3">14.2</span> Shortcut operators</h3>
<div class="outline-text-3" id="text-14-2">
<p>
Ruby has shortcut operators like <code>||=</code>, <code>+=</code>, <code>-=</code>, <code>*=</code>, <code>&=</code>
(bitwise AND), <code>|=</code> (bitwise OR), <code>^=</code> (bitwise EXCLUSIVE OR)
</p>

<p>
If you define a <code>+</code> method you can use the <code>+=</code> syntax.
Similarly if you define a <code>-</code> method you can use the <code>-=</code> syntax
and so on for all other operators.
</p>

<p>
Shortcut operators are:
</p>
<table>


<colgroup>
<col  class="left">

<col  class="left">
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Category</th>
<th scope="col" class="left">Operators</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">Arithmetic</td>
<td class="left"><code>+ - * / % **</code></td>
</tr>

<tr>
<td class="left">Data</td>
<td class="left"><code>[] []= <<</code></td>
</tr>

<tr>
<td class="left">Comparison</td>
<td class="left"><code><=> == > < >= <=</code></td>
</tr>

<tr>
<td class="left">Case equality</td>
<td class="left"><code>===</code></td>
</tr>

<tr>
<td class="left">Bitwise</td>
<td class="left"># & ^</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-14-3" class="outline-3">
<h3 id="sec-14-3"><span class="section-number-3">14.3</span> Unary operators</h3>
<div class="outline-text-3" id="text-14-3">
<p>
<code>+</code> and <code>-</code> as in <code>+1</code> and <code>-1</code> can be customized
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">def</span> <span class="org-function-name">+@</span>
<span class="org-keyword">end</span>

<span class="org-keyword">def</span> <span class="org-function-name">-@</span>
<span class="org-keyword">end</span>
</pre>
</div>

<p>
You can customize <code>!</code> which also gives you <code>not</code>
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">def</span> <span class="org-function-name">!</span>
  <span class="org-comment-delimiter">#</span><span class="org-comment">some code</span>
<span class="org-keyword">end</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-14-4" class="outline-3">
<h3 id="sec-14-4"><span class="section-number-3">14.4</span> <code>dangerous_method!</code></h3>
<div class="outline-text-3" id="text-14-4">
<p>
When you have a ! at the end of a method name. It usually means
this methods permanently modifies its receiver. But It is not
always the case. Especially when ! methods don’t have non-bang
equivalent.
Ex: <code>String.clear</code>. No ! but it changes the receiver.
</p>

<ul class="org-ul">
<li>Don’t use ! except in M/M! methods pars
</li>
<li>Don’t equate ! with destructive behavior or vice versa
It can mean something else.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-14-5" class="outline-3">
<h3 id="sec-14-5"><span class="section-number-3">14.5</span> conversions</h3>
<div class="outline-text-3" id="text-14-5">
<ul class="org-ul">
<li><code>to_s</code>
used by certain methods like <code>puts</code> and string interpolation. If you write your
own <code>to_s</code> for a class you can take advantage of it.
</li>
<li><code>to_a</code> and <code>*</code>
     The <code>*</code> turns any array into the equivalent of a bare list
<div class="org-src-container">

<pre class="src src-ruby">[*[1, 2, 3, 4, 5]] == [1, 2, 3, 4, 5]
</pre>
</div>

<pre class="example">
true
</pre>
</li>

<li><code>to_i</code>, <code>Integer</code>, <code>to_f</code>, <code>Float</code>
To convert integers and float. <code>Integer</code> and <code>Float</code> are
stricter versions
</li>
<li>Role-playing
<ul class="org-ul">
<li><code>to_str</code>
If you want to be able to add a string with your object,
you can define <code>to_str</code> for your object. <code>to_str</code> is used
by ruby for <i>String#+</i> and <i>String#<<</i>
</li>
<li><code>to_ary</code>
       To use ruby methods like <i>Array#concat</i>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-14-6" class="outline-3">
<h3 id="sec-14-6"><span class="section-number-3">14.6</span> Comparisons</h3>
<div class="outline-text-3" id="text-14-6">
<p>
if you define <code>==</code>, you automatically define <code>!=</code> for your
object.
<code>==</code> and <code>eql?</code> are usually redefined to do meaningful work.
<code>equal?</code> is usually left alone to check whether two objects are
exactly the same object.
</p>
</div>

<div id="outline-container-sec-14-6-1" class="outline-4">
<h4 id="sec-14-6-1"><span class="section-number-4">14.6.1</span> Comparable module</h4>
<div class="outline-text-4" id="text-14-6-1">
<p>
If you want objects of <code>MyClass</code> to have the full comparison
suite:
</p>

<ul class="org-ul">
<li>mix-in <code>Comparable</code>
</li>
<li>Define <code><=></code> (spaceship operator) for your class
<code><=></code> can return -1 (less than), 0 (equal) and 1 (greater
than)
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-14-7" class="outline-3">
<h3 id="sec-14-7"><span class="section-number-3">14.7</span> Inspecting</h3>
<div class="outline-text-3" id="text-14-7">
<p>
<code>String.methods.sort</code>
<code>String.instance_methods.sort</code>
Use <code>String.instance_methods(false).sort</code> to not see instance
methods provided by class’s ancestors.
</p>

<div class="org-src-container">

<pre class="src src-ruby">str = <span class="org-string">'ok'</span>
<span class="org-keyword">def</span> str.<span class="org-function-name">shout</span>
  <span class="org-variable-name">self</span>.upcase
<span class="org-keyword">end</span>
str.singleton_methods
</pre>
</div>

<table>


<colgroup>
<col  class="left">
</colgroup>
<tbody>
<tr>
<td class="left">:shout</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-14-8" class="outline-3">
<h3 id="sec-14-8"><span class="section-number-3">14.8</span> <code>try_convert</code></h3>
<div class="outline-text-3" id="text-14-8">
<p>
<code>try_convert</code> looks for a conversion method on argument object.
If it exists, it gets called, if not it returns <code>nil</code>. If the
object returned class is different that the class to which
conversion is attempted it returns a fatal error.
</p>

<div class="org-src-container">

<pre class="src src-ruby">obj = <span class="org-type">Object</span>.new
<span class="org-type">Array</span>.try_convert(obj)
</pre>
</div>

<pre class="example">
nil
</pre>

<div class="org-src-container">

<pre class="src src-ruby">obj = <span class="org-type">Object</span>.new
<span class="org-keyword">def</span> obj.<span class="org-function-name">to_ary</span>
  [1, 2, 3]
<span class="org-keyword">end</span>
<span class="org-type">Array</span>.try_convert(obj)
</pre>
</div>

<table>


<colgroup>
<col  class="right">

<col  class="right">

<col  class="right">
</colgroup>
<tbody>
<tr>
<td class="right">1</td>
<td class="right">2</td>
<td class="right">3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-sec-15" class="outline-2">
<h2 id="sec-15"><span class="section-number-2">15</span> Strings</h2>
<div class="outline-text-2" id="text-15">
<p>
A string literal is enclosed between ~"~ or ~'~ quotation marks
string interpolation does not work with ~'~
</p>
</div>
<div id="outline-container-sec-15-1" class="outline-3">
<h3 id="sec-15-1"><span class="section-number-3">15.1</span> String interpolation</h3>
<div class="outline-text-3" id="text-15-1">
<div class="org-src-container">

<pre class="src src-ruby">first_name = <span class="org-string">'Aurélien'</span>
<span class="org-builtin">puts</span> <span class="org-string">"I’m </span><span class="org-variable-name">#{first_name}</span><span class="org-string">"</span>
</pre>
</div>

<pre class="example">
I’m Aurélien
</pre>

<p>
You can also create a string with <code>%charDELIMITERtextDELIMITER</code>. <code>char</code> can be
</p>
<ul class="org-ul">
<li><code>%q</code>. Creates a single-quote string
</li>
<li><code>%Q</code>. Creates a double-quote string
</li>
<li><code>%</code>. Creates a double-quote string

<p>
delimiter can be any of two same character as long as you
match it on both end of the string. It can be a pair of
braces too.
</p>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-15-2" class="outline-3">
<h3 id="sec-15-2"><span class="section-number-3">15.2</span> <i>Here</i> document or <i>here-doc</i></h3>
<div class="outline-text-3" id="text-15-2">
<div class="org-src-container">

<pre class="src src-ruby">too = <span class="org-string">'too'</span>
text = <span class="org-string"><<EOM</span>
<span class="org-string">This text is splendid.</span>
<span class="org-string">Full of words, lines & punctuations.</span>
<span class="org-string">And with interpolation </span><span class="org-variable-name">#{too}</span>
<span class="org-string">EOM</span>
</pre>
</div>

<pre class="example">
This text is splendid.
Full of words, lines & punctuations.
And with interpolation too
</pre>

<p>
You can add single quotes for single quoted <i>here-doc</i>
</p>

<div class="org-src-container">

<pre class="src src-ruby">var_too = <span class="org-string">'too'</span>
text = <<<span class="org-string">'EOM'</span>
<span class="org-string">No interpolation </span><span class="org-variable-name">#{var_too}</span>
<span class="org-string">EOM</span>
</pre>
</div>

<pre class="example">
No interpolation #{var_too}
</pre>

<p>
<i>EOM</i> does not have to be the last thing on the line
</p>

<div class="org-src-container">

<pre class="src src-ruby">a = <span class="org-string"><<EOM</span>.to_i * 10
<span class="org-string">5</span>
<span class="org-string">EOM</span>
</pre>
</div>

<pre class="example">
50
</pre>

<div class="org-src-container">

<pre class="src src-ruby">array = [1, 2, 3, <span class="org-string"><<EOM</span>.to_i, 5]
<span class="org-string">4</span>
<span class="org-string">EOM</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-ruby">long_args(a, b, <span class="org-string"><<EOM</span>)
<span class="org-string">http://supersupersupersupersupersupersuperlongurl.com</span>
<span class="org-string">EOM</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-15-3" class="outline-3">
<h3 id="sec-15-3"><span class="section-number-3">15.3</span> Basic string manipulation</h3>
<div class="outline-text-3" id="text-15-3">
</div><div id="outline-container-sec-15-3-1" class="outline-4">
<h4 id="sec-15-3-1"><span class="section-number-4">15.3.1</span> Selection</h4>
<div class="outline-text-4" id="text-15-3-1">
<ul class="org-ul">
<li>negative numbers index from the end of the string
</li>
</ul>
<div class="org-src-container">

<pre class="src src-ruby">string = <span class="org-string">"ruby is cool"</span>
string[-1]
</pre>
</div>

<pre class="example">
l
</pre>

<ul class="org-ul">
<li>You can ask for a sub-string
</li>
</ul>
<div class="org-src-container">

<pre class="src src-ruby">string = <span class="org-string">"ruby is cool"</span>
string[5, 7]
</pre>
</div>

<pre class="example">
is cool
</pre>

<ul class="org-ul">
<li>You can provide a range
</li>
</ul>
<div class="org-src-container">

<pre class="src src-ruby"> string = <span class="org-string">"ruby is cool"</span>
string[5..11]
</pre>
</div>

<pre class="example">
is cool
</pre>

<div class="org-src-container">

<pre class="src src-ruby">string = <span class="org-string">"ruby is cool"</span>
string[5...11]
</pre>
</div>

<pre class="example">
is coo
</pre>

<ul class="org-ul">
<li>You can use sub-string search
</li>
</ul>
<div class="org-src-container">

<pre class="src src-ruby">string = <span class="org-string">"ruby is cool"</span>
string[<span class="org-string">'is'</span>]
</pre>
</div>

<pre class="example">
is
</pre>

<ul class="org-ul">
<li>And regular expression
</li>
</ul>
<div class="org-src-container">

<pre class="src src-ruby">string = <span class="org-string">"ruby is cool"</span>
string[<span class="org-string">/co+l/</span>]
</pre>
</div>

<pre class="example">
cool
</pre>
</div>
</div>

<div id="outline-container-sec-15-3-2" class="outline-4">
<h4 id="sec-15-3-2"><span class="section-number-4">15.3.2</span> changing strings</h4>
<div class="outline-text-4" id="text-15-3-2">
<ul class="org-ul">
<li>You can change part of a string using the same selection arguments
</li>
</ul>
<div class="org-src-container">

<pre class="src src-ruby">string = <span class="org-string">"ruby is cool"</span>
string[<span class="org-string">'cool'</span>] = <span class="org-string">'great'</span>
string
</pre>
</div>

<pre class="example">
ruby is great
</pre>

<ul class="org-ul">
<li>You can combine strings
With <code>+</code> the string you get back is always a new string. With
<code><<</code> we append permanently. No new string.
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-15-4" class="outline-3">
<h3 id="sec-15-4"><span class="section-number-3">15.4</span> Enumerable strings</h3>
<div class="outline-text-3" id="text-15-4">
<ul class="org-ul">
<li><code>each_byte</code> and <code>bytes</code>
</li>
<li><code>each_char</code> and <code>chars</code>
</li>
<li><code>each_codepoint</code> and <code>codepoints</code> provides character codes, one code per
character. Sometimes due to encoding the number of bytes is
greater than the number of code points.
</li>
<li><code>each_line</code> and <code>lines</code>
The string is split at each occurrence of <code>$/</code>. Which is the
end of lines by default.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-15-5" class="outline-3">
<h3 id="sec-15-5"><span class="section-number-3">15.5</span> Querying strings</h3>
<div class="outline-text-3" id="text-15-5">
<ul class="org-ul">
<li><code>String#include?('cool')</code>
</li>
<li><code>String#start_with?('ruby')</code>
</li>
<li><code>String#empty?</code>
</li>
<li><code>String#size</code>
</li>
<li><code>String#count('a')</code>, range of letters <code>String#count('a-c')</code> and you can
combine arguments <code>String#count('a-c', '^b' )</code> (any letters from a
to c that is not b)
</li>
<li><code>String#index('cool')</code>
</li>
<li><code>String#ord</code> gives ordinal code of first character. Reverse
operation is <code>String#chr</code>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-15-6" class="outline-3">
<h3 id="sec-15-6"><span class="section-number-3">15.6</span> String comparison</h3>
<div class="outline-text-3" id="text-15-6">
<ul class="org-ul">
<li><code>==</code> for equality of content
</li>
<li><code>String#equal?</code> for equality of object
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-15-7" class="outline-3">
<h3 id="sec-15-7"><span class="section-number-3">15.7</span> transformations</h3>
<div class="outline-text-3" id="text-15-7">
<ul class="org-ul">
<li><code>String#upcase</code>
</li>
<li><code>String#downcase</code>
</li>
<li><code>String#upcase</code>
</li>
<li><code>String#swapcase</code>
</li>
<li><code>String#capitalize</code>
</li>
<li><code>String#rjust(5)</code> and <code>String#ljust(5)</code> add padding to the
right of left with either blank spaces or a char if you add a
second char parameter.
</li>
<li><code>String#center(5)</code>. Same as <i>rjust</i> and <i>ljust</i> for parameters
</li>
<li><code>String#strip</code>, <code>String#lstrip</code> & <code>String#rstrip</code> removes
white-spaces
</li>
<li><code>String#chop</code> to remove a character at the end of the string
</li>
<li><code>String#chomp</code> to remove a newline character. You can target
other characters or strings by providing an argument <code>String#chomp('ab')</code>
</li>
<li><code>String#clear</code> clears the receiver. No ! but it changes the receiver.
</li>
<li><code>String#replace</code>
</li>
<li><code>String#delete</code> same rules for arguments as with count.
</li>
<li><code>String#succ</code> increment letters in a string. Handy when you
need a batch of generated unique strings.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-15-8" class="outline-3">
<h3 id="sec-15-8"><span class="section-number-3">15.8</span> Conversions</h3>
<div class="outline-text-3" id="text-15-8">
<p>
<code>to_sum</code>, <code>to_f</code>, <code>to_i</code>
You can provide a parameter to <code>to_i</code> to specify a base.
<code>.oct</code> for octal and <code>.hex</code> for hexadecimal.
</p>
</div>
</div>

<div id="outline-container-sec-15-9" class="outline-3">
<h3 id="sec-15-9"><span class="section-number-3">15.9</span> Encoding</h3>
<div class="outline-text-3" id="text-15-9">
<p>
In Ruby 2 the default encoding for ruby scripts is UTF-8.
</p>

<p>
you can use <code>__ENCODING__</code> to know the encoding value. Directly
in the file. If you run this command on the command line
through <code>$ ruby -e 'puts __ENCODING__</code> you will get the current
locale setting which can differ.
</p>

<p>
You can use a magic comment at the top of the file <code># encoding:
   encoding_Value</code> to change the encoding of a file.
</p>

<p>
<code>String#encoding</code> to get the encoding.
</p>

<p>
You can encode a string in a different encoding as long as the
conversion is permitted. This is called trans-coding.
<code>String.encode('US-ASCII')</code>. The bang version changes the
encoding of the string permanently.
</p>

<p>
You can force an encoding <code>String#force_encoding('US-ASCII')</code>
</p>

<p>
You can represent characters with escape sequence. <code>\x</code> for
two digit hexadecimal numbers representing a byte. <code>\u</code>
followed by a UTF-8 code to insert the corresponding
character. By doing this you can change a string encoding to
UTF-8 (if it was in ASCII and the character inserted does not
exist in ASCII).
</p>
</div>
</div>

<div id="outline-container-sec-15-10" class="outline-3">
<h3 id="sec-15-10"><span class="section-number-3">15.10</span> XOR and strings</h3>
<div class="outline-text-3" id="text-15-10">
<p>
If you XOR two times the same things you get back the original
value.
So <code>(a^b)^b = a</code>. This is an interesting obfuscation technique
with strings.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">class</span> <span class="org-type">String</span>
  <span class="org-keyword">def</span> <span class="org-function-name">^</span>(key)
    kenum = key.each_byte.cycle
    each_byte.map {|byte| byte ^ kenum.next }.pack(<span class="org-string">"C*"</span>).force_encoding(<span class="org-variable-name">self</span>.encoding)
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>

<span class="org-builtin">puts</span> <span class="org-string">'hello'</span> ^ <span class="org-string">'secret key'</span> ^ <span class="org-string">'secret key'</span>
</pre>
</div>

<pre class="example">
hello
</pre>

<p>
Here <code>pack("C*")</code> turns an array into a string. The <code>C*</code>
arguments tells pack to treat each element of the array as an
unsigned integer representing a single character (<code>C</code>) and process
all of them (<code>*</code>).
</p>
</div>
</div>
</div>

<div id="outline-container-sec-16" class="outline-2">
<h2 id="sec-16"><span class="section-number-2">16</span> Symbols</h2>
<div class="outline-text-2" id="text-16">
<p>
literal constructor <code>:symbol_name</code>
</p>

<ul class="org-ul">
<li>symbols are immutable
</li>
<li>symbols are unique. Thus there is no point in having
constructor for them. They are like integers in that respect
</li>
</ul>

<p>
When you bin a variable to a symbol you bind its value, not a
reference to it.
</p>

<p>
You can list all symbols with <code>Symbol.all_symbols</code>
</p>

<p>
If you want to check if a symbol exist you can use <i>grep</i>
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-type">Symbol</span>.all_symbols.grep(<span class="org-string">/abc/</span>)
</pre>
</div>

<p>
Don’t use <code>include?(:abc)</code> because this very act creates the
symbol!
</p>

<p>
Symbols appears most of the times in method arguments and hash
keys. They are better for hash keys because ruby can process
them faster and they look good as hash keys. Ruby also use a
convenient way to use symbol as hash keys
</p>

<p>
The following two are equivalent
</p>
<div class="org-src-container">

<pre class="src src-ruby">hash = { <span class="org-constant">:name</span> => <span class="org-string">'Aurélien'</span>, <span class="org-constant">:age</span> => 35 }
hash = { <span class="org-constant">name</span>: <span class="org-string">'Aurélien'</span>, <span class="org-constant">age</span>: 35}
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-17" class="outline-2">
<h2 id="sec-17"><span class="section-number-2">17</span> Numerical</h2>
<div class="outline-text-2" id="text-17">
<p>
At the top <i>Numeric</i>.
<i>Float</i> and <i>Integer</i> below.
<i>Fixnum</i> and <i>Bignum</i> below Integer. Ruby handles the
conversion automatically when you need <i>Bignum</i>.
</p>

<p>
With divisions, when you want integers you have to specify it.
</p>

<div class="org-src-container">

<pre class="src src-ruby">3 / 2
</pre>
</div>

<pre class="example">
1
</pre>


<div class="org-src-container">

<pre class="src src-ruby">3 / 2.0
</pre>
</div>

<pre class="example">
1.5
</pre>

<p>
Hexadecimals with leading 0x
</p>

<div class="org-src-container">

<pre class="src src-ruby">0x12 + 10
</pre>
</div>

<pre class="example">
28
</pre>

<p>
Octals when leading 0
</p>

<div class="org-src-container">

<pre class="src src-ruby">012 + 10
</pre>
</div>

<pre class="example">
20
</pre>
</div>
</div>

<div id="outline-container-sec-18" class="outline-2">
<h2 id="sec-18"><span class="section-number-2">18</span> Times and dates</h2>
<div class="outline-text-2" id="text-18">
<p>
3 classes. <i>Time</i>, <i>Date</i> and <i>DateTime</i>
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-builtin">require</span> <span class="org-string">'time'</span>
<span class="org-builtin">require</span> <span class="org-string">'date'</span> <span class="org-comment-delimiter">#</span><span class="org-comment">provides both Date and Datetime</span>
</pre>
</div>

<p>
You can query for <code>leap?</code> years and <code>dst?</code> (daylight saving
time)
There is an <code>strftime</code> methods to format
Precooked format <i>rfc2822</i> for email and <code>httpdate</code> (RFC 2616
standard).
You can use <code>upto</code> and <code>downto</code> to iterate over a range of them
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-builtin">require</span> <span class="org-string">'date'</span>
d = <span class="org-type">Date</span>.today
next_week = d + 7

d.upto(next_week)
</pre>
</div>

<pre class="example">
#<Enumerator: #<Date: 2014-11-20 ((2456982j,0s,0n),+0s,2299161j)>:upto(#<Date: 2014-11-27 ((2456989j,0s,0n),+0s,2299161j)>)>
</pre>
</div>
</div>

<div id="outline-container-sec-19" class="outline-2">
<h2 id="sec-19"><span class="section-number-2">19</span> Collections</h2>
<div class="outline-text-2" id="text-19">
<p>
Ruby implements collections principally through classes that min
in <code>Enumerable</code>.
</p>

<p>
<code>with_index</code> is a method which yields a counter value along with
the enumerator. Pretty new and preferable to <code>each_with_index</code>.
</p>
</div>

<div id="outline-container-sec-19-1" class="outline-3">
<h3 id="sec-19-1"><span class="section-number-3">19.1</span> Array</h3>
<div class="outline-text-3" id="text-19-1">
<p>
You can create an array with
</p>
<ul class="org-ul">
<li><code>Array.new</code>
</li>
</ul>
<div class="org-src-container">

<pre class="src src-ruby"><span class="org-builtin">puts</span> <span class="org-type">Array</span>.new(3)
</pre>
</div>

<pre class="example">

</pre>

<p>
Be careful with the following example. The 3 elements of the
array are initialized with the same string. If you modify it
for one element, you modify it for all elements of the Array.
</p>


<div class="org-src-container">

<pre class="src src-ruby"><span class="org-type">Array</span>.new(3, <span class="org-string">'abc'</span>)
</pre>
</div>

<table>


<colgroup>
<col  class="left">

<col  class="left">

<col  class="left">
</colgroup>
<tbody>
<tr>
<td class="left">abc</td>
<td class="left">abc</td>
<td class="left">abc</td>
</tr>
</tbody>
</table>

<p>
With a block, all 3 strings are different
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-type">Array</span>.new(3) { <span class="org-string">'abc'</span>}
</pre>
</div>

<table>


<colgroup>
<col  class="left">

<col  class="left">

<col  class="left">
</colgroup>
<tbody>
<tr>
<td class="left">abc</td>
<td class="left">abc</td>
<td class="left">abc</td>
</tr>
</tbody>
</table>

<div class="org-src-container">

<pre class="src src-ruby">n = 0
<span class="org-type">Array</span>.new(3) { n += 1; n * 10}
</pre>
</div>

<table>


<colgroup>
<col  class="right">

<col  class="right">

<col  class="right">
</colgroup>
<tbody>
<tr>
<td class="right">10</td>
<td class="right">20</td>
<td class="right">30</td>
</tr>
</tbody>
</table>


<ul class="org-ul">
<li>[]
</li>
<li>top level method <code>Array</code>
If an element has an <code>to~ary</code> method the <code>Array</code> call use
that method. If not it tries with <code>to_a</code>. If not it wraps the
object in an Array
</li>
</ul>

<div class="org-src-container">

<pre class="src src-ruby">string = <span class="org-string">"cool"</span>
<span class="org-keyword">def</span> string.<span class="org-function-name">to_a</span>
  split(<span class="org-string">//</span>)
<span class="org-keyword">end</span>
<span class="org-builtin">Array</span>(string)
</pre>
</div>

<table>


<colgroup>
<col  class="left">

<col  class="left">

<col  class="left">

<col  class="left">
</colgroup>
<tbody>
<tr>
<td class="left">c</td>
<td class="left">o</td>
<td class="left">o</td>
<td class="left">l</td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li>special notations %w{} and #i{}

<p>
%w single quoted and %W double quoted
</p>
</li>
</ul>
<div class="org-src-container">

<pre class="src src-ruby"><span class="org-string">%w{ It is a small world }</span>
</pre>
</div>

<table>


<colgroup>
<col  class="left">

<col  class="left">

<col  class="left">

<col  class="left">

<col  class="left">
</colgroup>
<tbody>
<tr>
<td class="left">It</td>
<td class="left">is</td>
<td class="left">a</td>
<td class="left">small</td>
<td class="left">world</td>
</tr>
</tbody>
</table>

<p>
<code>%i</code> and <code>%I</code> for array of symbols single and double quoted
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-string">%i{It is a small world}</span>
</pre>
</div>
</div>

<div id="outline-container-sec-19-1-1" class="outline-4">
<h4 id="sec-19-1-1"><span class="section-number-4">19.1.1</span> Inserting, retrieving and removing from an array</h4>
<div class="outline-text-4" id="text-19-1-1">
<table>


<colgroup>
<col  class="left">

<col  class="left">
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Sample call</th>
<th scope="col" class="left">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left"><code>a[3, 2]</code></td>
<td class="left">select two elements starting at index 3</td>
</tr>

<tr>
<td class="left"><code>array.values_At(0,3)</code></td>
<td class="left">select values at index 0 and 3</td>
</tr>

<tr>
<td class="left"><code>a.unshift(0)</code></td>
<td class="left">adds 0 at start of array</td>
</tr>

<tr>
<td class="left"><code>a.shift(n=1)</code></td>
<td class="left">remove n elements from beginning of array</td>
</tr>

<tr>
<td class="left"><code>a.pop(n=1)</code></td>
<td class="left">remove n elements from end of array</td>
</tr>

<tr>
<td class="left"><code>a.push(6,7,8)</code></td>
<td class="left">adds 6, 7 and 8 at the end of the array</td>
</tr>

<tr>
<td class="left"><code>a << 5</code></td>
<td class="left">add 5 at the end of the array</td>
</tr>

<tr>
<td class="left"><code>[1, 2, 3].concat([4, 5, 6])</code></td>
<td class="left"><code>[1, 2, 3, 4, 5, 6]</code> changes permanently receiver</td>
</tr>

<tr>
<td class="left"><code>[1, 2, 3] + [4, 5, 6]</code></td>
<td class="left"><code>[1, 2, 3, 4, 5, 6]</code> creates a new array</td>
</tr>

<tr>
<td class="left"><code>[1, 2, 4].replace([4, 5, 6])</code></td>
<td class="left"><code>[4, 5, 6]</code> Keeps same object</td>
</tr>

<tr>
<td class="left"><code>[1, [2, [3, 4]]].flatten</code></td>
<td class="left"><code>[1, 2, 3]</code> flattens completely</td>
</tr>

<tr>
<td class="left"><code>[1, [2, [3, 4]]].flatten(1)</code></td>
<td class="left"><code>[1, 2, [3, 4]]</code> flattens one level</td>
</tr>

<tr>
<td class="left"><code>[1, 2, 3, 4].reverse</code></td>
<td class="left"><code>[4, 3, 2, 1]</code></td>
</tr>

<tr>
<td class="left"><code>['abc', 'def'].join(arg='')</code></td>
<td class="left"><code>abcdef</code> join all argument and returns a string</td>
</tr>

<tr>
<td class="left"><code>[1, 1, 2, 3].uniq</code></td>
<td class="left"><code>[1, 2, 3]</code></td>
</tr>

<tr>
<td class="left"><code>[1, nil, 2, nil].compact</code></td>
<td class="left"><code>[1, 2]</code> removes nil</td>
</tr>
</tbody>
</table>
</div>
</div>


<div id="outline-container-sec-19-1-2" class="outline-4">
<h4 id="sec-19-1-2"><span class="section-number-4">19.1.2</span> Querying</h4>
<div class="outline-text-4" id="text-19-1-2">
<table>


<colgroup>
<col  class="left">

<col  class="left">
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Sample call</th>
<th scope="col" class="left">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left"><code>a.size</code> and <code>a.length</code></td>
<td class="left">Number of elements in array</td>
</tr>

<tr>
<td class="left"><code>a.empty?</code></td>
<td class="left">True if a is empty</td>
</tr>

<tr>
<td class="left"><code>a.include?(element)</code></td>
<td class="left">True if array includes <code>element</code></td>
</tr>

<tr>
<td class="left"><code>a.count(element)</code></td>
<td class="left">number of <code>element</code></td>
</tr>

<tr>
<td class="left"><code>a.first(n=1)</code></td>
<td class="left">first n elements</td>
</tr>

<tr>
<td class="left"><code>a.last(n=1)</code></td>
<td class="left">last n elements</td>
</tr>

<tr>
<td class="left"><code>a.smaple(n=1)</code></td>
<td class="left">n random elements</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-sec-19-2" class="outline-3">
<h3 id="sec-19-2"><span class="section-number-3">19.2</span> Hashes</h3>
<div class="outline-text-3" id="text-19-2">
<p>
Hashes are now ordered collections.
</p>

<p>
You can use <code>(key, value)</code> in blocks to get the hash element
array distributed across two parameters.
Key values are unique
Hash provides quick look-up in better than linear time
</p>

<div class="org-src-container">

<pre class="src src-ruby">hash = { <span class="org-constant">red</span>: <span class="org-string">'ruby'</span>, <span class="org-constant">white</span>: <span class="org-string">'diamond'</span>, <span class="org-constant">green</span>: <span class="org-string">'emerald'</span>}
output = <span class="org-string">''</span>
hash.each.with_index <span class="org-keyword">do</span> |(key, value), i|
  output << <span class="org-string">"PAIR </span><span class="org-variable-name">#{i}</span><span class="org-string"> is </span><span class="org-variable-name">#{key}</span><span class="org-string">/</span><span class="org-variable-name">#{value}</span><span class="org-string">\n"</span>
<span class="org-keyword">end</span>
output
</pre>
</div>

<p>
You can create an Hash with:
</p>
<ul class="org-ul">
<li><code>{}</code>
<div class="org-src-container">

<pre class="src src-ruby">h = {}
</pre>
</div>

<pre class="example">
{}
</pre>
</li>

<li><code>Hash.new</code>
<div class="org-src-container">

<pre class="src src-ruby">h = <span class="org-type">Hash</span>.new(3) <span class="org-comment-delimiter">#</span><span class="org-comment">argument serves as default value for nonexistent hash keys</span>
h[<span class="org-constant">:my_key</span>]
</pre>
</div>

<pre class="example">
3
</pre>

<p>
You can use blocks too!
</p>
<div class="org-src-container">

<pre class="src src-ruby">h = <span class="org-type">Hash</span>.new {|hash, key| hash[key] = 0 }
h[<span class="org-constant">:my_key</span>]
</pre>
</div>

<pre class="example">
0
</pre>
</li>

<li><code>Hash.[]</code>
     If you provide an odd number of argument a fatal error is raised
<div class="org-src-container">

<pre class="src src-ruby"><span class="org-type">Hash</span>[<span class="org-string">'France'</span>, <span class="org-string">'fr'</span>, <span class="org-string">'USA'</span>, <span class="org-string">'us'</span>]
</pre>
</div>
</li>

<li><code>Hash</code>
Calls <code>to_hash</code> on its single argument. Except if you pass it
an empty <code>Array</code> or <code>nil</code> it returns an empty hash <code>{}</code>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-builtin">Hash</span>([])
</pre>
</div>

<pre class="example">
{}
</pre>
</li>
</ul>
</div>

<div id="outline-container-sec-19-2-1" class="outline-4">
<h4 id="sec-19-2-1"><span class="section-number-4">19.2.1</span> Hash methods</h4>
<div class="outline-text-4" id="text-19-2-1">
<table>


<colgroup>
<col  class="left">

<col  class="left">
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Sample call</th>
<th scope="col" class="left">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left"><code>=h['France'] = 'fr'=</code></td>
<td class="left">adds a key/value pair</td>
</tr>

<tr>
<td class="left"><code>h.store('France', 'fr')</code></td>
<td class="left">adds a key/value pair</td>
</tr>

<tr>
<td class="left"><code>h['France']</code></td>
<td class="left">fetch value</td>
</tr>

<tr>
<td class="left"><code>h.fetch('France')</code></td>
<td class="left">fetch value, raises an exception for non existent key</td>
</tr>

<tr>
<td class="left"><code>h.values_att('France', 'USA')</code></td>
<td class="left">return arrays of value</td>
</tr>

<tr>
<td class="left"><code>h1.update(h2)</code> or <code>h1.merge!(h2)</code></td>
<td class="left">h1 keys are overwritten with corresponding h2 keys</td>
</tr>

<tr>
<td class="left"><code>h1.merge(h2)</code></td>
<td class="left">creates a new hash combining h1 and h2.</td>
</tr>

<tr>
<td class="left"> </td>
<td class="left">If both hash have keys in common h2 keys win</td>
</tr>

<tr>
<td class="left"><code>h.select {\vert{}k,v\vert k > 1}</code></td>
<td class="left">creates a sub-hash by selection</td>
</tr>

<tr>
<td class="left"><code>h.reject {\vert{}k,v\vert k > 1}</code></td>
<td class="left">creates a sub-hash by rejection</td>
</tr>

<tr>
<td class="left"><code>select!</code> and <code>reject!</code></td>
<td class="left">returns nil if hash does not change</td>
</tr>

<tr>
<td class="left"><code>keep_if</code> and <code>delete_if</code></td>
<td class="left">returns original hash even if it's unchanged</td>
</tr>

<tr>
<td class="left"><code>h.invert</code></td>
<td class="left">invert keys and values. Careful:keys must be unique</td>
</tr>

<tr>
<td class="left"><code>h.clear</code></td>
<td class="left">clears a hash</td>
</tr>

<tr>
<td class="left"><code>h.replace</code></td>
<td class="left">replace content of a hash</td>
</tr>
</tbody>
</table>
</div>
</div>


<div id="outline-container-sec-19-2-2" class="outline-4">
<h4 id="sec-19-2-2"><span class="section-number-4">19.2.2</span> Querying</h4>
<div class="outline-text-4" id="text-19-2-2">
<ul class="org-ul">
<li><code>h.has_key(1)</code>
</li>
<li><code>h.include?(1)</code>
</li>
<li><code>h.member?(1)</code>
</li>
<li><code>h.has_value?(1)</code>
</li>
<li><code>h.value?(1)</code>
</li>
<li><code>h.empty?</code>
</li>
<li><code>h.size</code>
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-19-3" class="outline-3">
<h3 id="sec-19-3"><span class="section-number-3">19.3</span> Ranges</h3>
<div class="outline-text-3" id="text-19-3">
<p>
Semantics of range:
</p>
<ul class="org-ul">
<li><i>Inclusion</i>
</li>
<li><i>Enumeration</i>

<p>
You can remember inclusive <i>..</i> and exclusive <i>…</i> range
notation by thinking of a range as always reaching to the
point represented by whatever follows the second dot.
</p>
</li>
</ul>


<p>
You can create ranges with
</p>
<ul class="org-ul">
<li><code>Range.new</code>
<div class="org-src-container">

<pre class="src src-ruby"><span class="org-type">Range</span>.new(1, 100)
</pre>
</div>

<pre class="example">
1..100
</pre>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-type">Range</span>.new(1, 100, <span class="org-variable-name">true</span>)
</pre>
</div>

<pre class="example">
1...100
</pre>
</li>

<li>Literal syntax
<div class="org-src-container">

<pre class="src src-ruby">1..100
</pre>
</div>

<pre class="example">
1..100
</pre>
</li>
</ul>


<p>
Ranges have <code>begin</code> and <code>end</code> method which report their
beginning and end point.
They also have <code>exclude_end?</code> which tells you if it is an
exclusive or inclusive range.
They have a <code>cover?</code> method to know if parameter falls in
range.
</p>
<div class="org-src-container">

<pre class="src src-ruby">(<span class="org-string">'a'</span>..<span class="org-string">'z'</span>).cover?(<span class="org-string">'abc'</span>)
</pre>
</div>

<pre class="example">
true
</pre>

<p>
They have an <code>include?</code> method which treats range as arrays.
Therefore results differs from <code>cover?</code>
</p>
<div class="org-src-container">

<pre class="src src-ruby">(<span class="org-string">'a'</span>..<span class="org-string">'z'</span>).include?(<span class="org-string">'abc'</span>)
</pre>
</div>

<pre class="example">
false
</pre>

<p>
Don’t create backward range. They won’t do what you think they
do.
</p>

<div class="org-src-container">

<pre class="src src-ruby">(100..1).include?(50)
</pre>
</div>

<pre class="example">
false
</pre>
</div>
</div>

<div id="outline-container-sec-19-4" class="outline-3">
<h3 id="sec-19-4"><span class="section-number-3">19.4</span> Sets</h3>
<div class="outline-text-3" id="text-19-4">
<p>
A set is a unique collection of objects.
</p>

<p>
You need to
</p>
<div class="org-src-container">

<pre class="src src-ruby"><span class="org-builtin">require</span> <span class="org-string">'set'</span>
</pre>
</div>

<pre class="example">
true
</pre>


<p>
You can create sets with <code>Set.new</code> by providing a collection of
objects and optionally a code block.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-builtin">require</span> <span class="org-string">'set'</span>
<span class="org-type">Set</span>.new([<span class="org-string">'Aurélien'</span>,<span class="org-string">'Romain'</span>, <span class="org-string">'Andréa'</span>]) {|name| name.upcase}
</pre>
</div>

<pre class="example">
#<Set: {"AURéLIEN", "ROMAIN", "ANDRéA"}>
</pre>

<p>
Use <code><<</code> to add a single object to a set.
You can also use <code>add</code> to add an object to a set. <code>add?</code>
returns nil if the set is unchanged after add operation.
Use <code>delete</code> to remove an object for a set.
</p>


<p>
You can use <code>&</code> to perform intersections. <code>+</code> and <code>|</code> for
unions and <code>-</code> for differences.
There is also an <code>^</code> exclusive or operator.
</p>

<p>
Merging a hash into a set results in the addition of
two-element.
You can test for <code>subset?</code> and <code>superset?</code>.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-20" class="outline-2">
<h2 id="sec-20"><span class="section-number-2">20</span> Enumerable and Enumerator</h2>
<div class="outline-text-2" id="text-20">
<p>
You can mix-in in <code>Enumerable</code> and define an <code>each</code> instance
method. You will be able to call any instance method defined in
<code>Enumerable</code>.
<code>each</code> job is to <i>yield</i> items.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">class</span> <span class="org-type">BlueColors</span>
  <span class="org-builtin">include</span> <span class="org-type">Enumerable</span>

  <span class="org-keyword">def</span> <span class="org-function-name">each</span>
    <span class="org-keyword">yield</span> <span class="org-string">'Light Blue'</span>
    <span class="org-keyword">yield</span> <span class="org-string">'Blue'</span>
    <span class="org-keyword">yield</span> <span class="org-string">'Dark Blue'</span>
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>

<span class="org-type">BlueColors</span>.new.each { |c| <span class="org-builtin">puts</span> c }

<span class="org-builtin">puts</span> <span class="org-type">BlueColors</span>.new.find { |c| c.start_with?(<span class="org-string">'B'</span>) }
</pre>
</div>

<pre class="example">
Light Blue
Blue
Dark Blue
Blue
</pre>
</div>

<div id="outline-container-sec-20-1" class="outline-3">
<h3 id="sec-20-1"><span class="section-number-3">20.1</span> Enumerable</h3>
<div class="outline-text-3" id="text-20-1">
</div><div id="outline-container-sec-20-1-1" class="outline-4">
<h4 id="sec-20-1-1"><span class="section-number-4">20.1.1</span> Queries</h4>
<div class="outline-text-4" id="text-20-1-1">
<ul class="org-ul">
<li><code>include?</code>
</li>
<li><code>all?</code>
</li>
<li><code>any?</code>
</li>
<li><code>one?</code>
</li>
<li><code>none?</code>
</li>
</ul>

<p>
Be careful when enumerating with ranges.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">begin</span>
     <span class="org-builtin">puts</span> (1.0..10.0).one? { |n| n == 5}
<span class="org-keyword">rescue</span> <span class="org-type">Exception</span> => e
  <span class="org-builtin">puts</span> e.message
<span class="org-keyword">end</span>
</pre>
</div>

<pre class="example">
can't iterate from Float
</pre>
</div>
</div>

<div id="outline-container-sec-20-1-2" class="outline-4">
<h4 id="sec-20-1-2"><span class="section-number-4">20.1.2</span> Search and Select</h4>
<div class="outline-text-4" id="text-20-1-2">
<ul class="org-ul">
<li><code>find</code>. You can provide a failure-handling function
<div class="org-src-container">

<pre class="src src-ruby">failure = <span class="org-builtin">lambda</span> { 11 }
[1,2,3,4,5,6].find(failure) {|n| n> 10}
</pre>
</div>
</li>

<li><code>find_all</code> also known as <code>select</code>. Always returns an array.
There’s a <code>select!</code>.
</li>
<li><code>reject</code>. Always returns an array
</li>
<li><code>grep</code>. Based on <code>===</code>
</li>
<li><code>group_by</code>. Returns a Hash

<div class="org-src-container">

<pre class="src src-ruby">colors = <span class="org-string">%w{ red orange yellow green blue indigo violet}</span>
colors.group_by {|color| color.size}
</pre>
</div>
</li>

<li><code>partition</code>. Similar to <code>group_by</code> but split into two arrays.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-20-1-3" class="outline-4">
<h4 id="sec-20-1-3"><span class="section-number-4">20.1.3</span> Element operations:</h4>
<div class="outline-text-4" id="text-20-1-3">
<ul class="org-ul">
<li><code>first</code>. There is no default <code>last</code> because there are some
iterations that goes forever. <code>Array</code> and <code>Range</code> have a
<code>last</code> method.
</li>
<li><code>take</code> and <code>take_while</code>
</li>
<li><code>drop</code> and <code>drop_while</code>
</li>
<li><code>min</code> and <code>max</code>. Determined by <code><=></code> (spaceship operator).
</li>
<li><code>min_by</code> and <code>max_by</code>
</li>
<li><code>minmax_by</code> and <code>maxmin_by</code>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-20-1-4" class="outline-4">
<h4 id="sec-20-1-4"><span class="section-number-4">20.1.4</span> Each relatives</h4>
<div class="outline-text-4" id="text-20-1-4">
<ul class="org-ul">
<li><code>reverse_each</code>
</li>
<li><code>with_index</code>. <code>each_with_index</code> is somewhat deprecated.
With <code>with_index</code> you can provide an argument that will be
used as the first index value.
</li>
<li><code>each_slice(n)</code> handles each element once. <code>each_cons(3)</code>
     takes a new grouping at each element.
</li>
<li><code>cycle(n)</code> to decide how many times you want to cycle through
a collection.
</li>
<li><code>inject</code> similar to reduce and fold in functional languages.
<div class="org-src-container">

<pre class="src src-ruby">[1,2,3,4].inject(0) {|acc, n| acc + n}
</pre>
</div>

<pre class="example">
10
</pre>
</li>

<li><code>map</code> also available as <code>collect</code>
<code>each</code> returns its receiver
<code>map</code> returns a new object
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-20-1-5" class="outline-4">
<h4 id="sec-20-1-5"><span class="section-number-4">20.1.5</span> Sorting</h4>
<div class="outline-text-4" id="text-20-1-5">
<ol class="org-ol">
<li>You need to define <code><=></code> the comparison method for the
class. If you <i>mixin</i> enumerable you get  all comparison
operations (>, <, and so on).
</li>
<li>Place multiples instances of the class in a container
</li>
<li>Sort the container
</li>
</ol>


<p>
Two sorting methods for <i>enumerable</i>:
</p>
<ol class="org-ol">
<li><code>sort</code>. Can take a block if you did not define <code><=></code>
</li>
<li><code>sort_by</code>. Always take block
<div class="org-src-container">

<pre class="src src-ruby">[<span class="org-string">'2'</span>, <span class="org-string">'1'</span>, <span class="org-string">'3'</span>].sort_by {|a| a.to_i }
</pre>
</div>

<table>


<colgroup>
<col  class="right">

<col  class="right">

<col  class="right">
</colgroup>
<tbody>
<tr>
<td class="right">1</td>
<td class="right">2</td>
<td class="right">3</td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-sec-20-2" class="outline-3">
<h3 id="sec-20-2"><span class="section-number-3">20.2</span> Enumerator</h3>
<div class="outline-text-3" id="text-20-2">
<p>
<code>Enumerator</code> uses <i>Enumerable</i> module to define all usual
methods <code>inject</code>, <code>select</code>, <code>map</code> on top of its <code>each</code>.
</p>

<p>
After you’ve told how to do <code>each</code>, <code>Enumerator</code> takes over and
figures how to do the rest.
</p>
</div>

<div id="outline-container-sec-20-2-1" class="outline-4">
<h4 id="sec-20-2-1"><span class="section-number-4">20.2.1</span> creating enumerators</h4>
<div class="outline-text-4" id="text-20-2-1">
</div><ol class="org-ol"><li><a id="sec-20-2-1-1"></a>with a code block<br ><div class="outline-text-5" id="text-20-2-1-1">
<div class="org-src-container">

<pre class="src src-ruby"><span class="org-type">Enumerator</span>.new <span class="org-keyword">do</span> |y|
  y << 1
  y << 2
  y << 3
<span class="org-keyword">end</span>
</pre>
</div>

<p>
<code>y</code> is a <i>yielder</i>. Here we are saying, when the <i>Enumerator</i>
get an <i>each</i> call, please take note that your need to yield
<code>1</code>, then <code>2</code>, then <code>3</code>. <code><<</code> tells <code>y</code> what it should yield.
You could also write <code>y.yield(1)</code>.
</p>

<p>
Note you don’t <i>yield</i> from the block. The following is wrong:
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-type">Enumerator</span>.new <span class="org-keyword">do</span> <span class="org-comment-delimiter">#</span><span class="org-comment">wrong</span>
  <span class="org-keyword">yield</span> 1         <span class="org-comment-delimiter">#</span><span class="org-comment">wrong</span>
  <span class="org-keyword">yield</span> 2         <span class="org-comment-delimiter">#</span><span class="org-comment">wrong</span>
  <span class="org-keyword">yield</span> 3         <span class="org-comment-delimiter">#</span><span class="org-comment">wrong</span>
<span class="org-keyword">end</span>               <span class="org-comment-delimiter">#</span><span class="org-comment">wrong</span>
</pre>
</div>
</div>
</li>

<li><a id="sec-20-2-1-2"></a>with <code>enum_for</code><br ><div class="outline-text-5" id="text-20-2-1-2">
<p>
In the following example <code>each</code> serve as a kind of front end
to array’s select.
</p>

<div class="org-src-container">

<pre class="src src-ruby">e = <span class="org-string">%w{ Paris Boston Tokyo }</span>.enum_for(<span class="org-constant">:select</span>)
e.each {|n| n.include?(<span class="org-string">'a'</span>)}
</pre>
</div>

<table>


<colgroup>
<col  class="left">
</colgroup>
<tbody>
<tr>
<td class="left">Paris</td>
</tr>
</tbody>
</table>

<p>
Most built-in iterators return an enumerator when they’re
called without a block. The following two are equivalent
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-string">%w{ Paris Boston Tokyo }</span>.enum_for(<span class="org-constant">:select</span>)
<span class="org-string">%w{ Paris Boston Tokyo }</span>.select
</pre>
</div>

<pre class="example">
#<Enumerator: ["Paris", "Boston", "Tokyo"]:select>
</pre>
</div>
</li></ol>
</div>

<div id="outline-container-sec-20-2-2" class="outline-4">
<h4 id="sec-20-2-2"><span class="section-number-4">20.2.2</span> Protecting from change</h4>
<div class="outline-text-4" id="text-20-2-2">
<p>
Instead of passing an original array you can pass an
enumerator. This way your enumerator won’t absorb changes.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">class</span> <span class="org-type">Cards</span>
  <span class="org-keyword">def</span> <span class="org-function-name">cards</span>
    <span class="org-variable-name">@cards</span>.to_enum
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-20-2-3" class="outline-4">
<h4 id="sec-20-2-3"><span class="section-number-4">20.2.3</span> Slow motion</h4>
<div class="outline-text-4" id="text-20-2-3">
<p>
You can use <code>next</code>, <code>rewind</code> to move in <code>slow motion</code>.
</p>
</div>
</div>

<div id="outline-container-sec-20-2-4" class="outline-4">
<h4 id="sec-20-2-4"><span class="section-number-4">20.2.4</span> Adding enumerability with an enumerator</h4>
<div class="outline-text-4" id="text-20-2-4">
<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">class</span> <span class="org-type">Scale</span>
  <span class="org-type">NOTES</span> = <span class="org-string">%w{ do re mi fa sol la si do}</span>
  <span class="org-keyword">def</span> <span class="org-function-name">play</span>
    <span class="org-type">NOTES</span>.each {|note| <span class="org-keyword">yield</span> note }
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>

enum = <span class="org-type">Scale</span>.new.enum_for(<span class="org-constant">:play</span>)
</pre>
</div>

<p>
And you can use all <i>enumerable</i> methods on <code>enum</code>.
</p>
</div>
</div>

<div id="outline-container-sec-20-2-5" class="outline-4">
<h4 id="sec-20-2-5"><span class="section-number-4">20.2.5</span> Chaining</h4>
<div class="outline-text-4" id="text-20-2-5">
<p>
Be careful when chaining. <code>names.each.inject</code> can be
<code>names.inject</code> and <code>names.map.select</code> can be <code>names.select</code>
</p>
</div>
</div>

<div id="outline-container-sec-20-2-6" class="outline-4">
<h4 id="sec-20-2-6"><span class="section-number-4">20.2.6</span> Lazy enumerators</h4>
<div class="outline-text-4" id="text-20-2-6">
<p>
To enumerate selectively over infinitely large collections.
</p>

<div class="org-src-container">

<pre class="src src-ruby">(1..<span class="org-type">Float</span>::<span class="org-type">INFINITY</span>).lazy.select { |n| n % 3 == 0 }.first(10)
</pre>
</div>

<table>


<colgroup>
<col  class="right">

<col  class="right">

<col  class="right">

<col  class="right">

<col  class="right">

<col  class="right">

<col  class="right">

<col  class="right">

<col  class="right">

<col  class="right">
</colgroup>
<tbody>
<tr>
<td class="right">3</td>
<td class="right">6</td>
<td class="right">9</td>
<td class="right">12</td>
<td class="right">15</td>
<td class="right">18</td>
<td class="right">21</td>
<td class="right">24</td>
<td class="right">27</td>
<td class="right">30</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-21" class="outline-2">
<h2 id="sec-21"><span class="section-number-2">21</span> Regular Expressions</h2>
<div class="outline-text-2" id="text-21">
<p>
<a href="http://rubular.com/">Rubular</a>: online Ruby regular expression editor
</p>

<p>
<code>//</code> is the regexp literal constructor
</p>

<p>
You can use <code>match</code> or <code>=~</code> on strings. <code>=~</code> returns the
numerical index of the character in the string where the match
started. <code>match</code> returns an instance of the class <code>MatchData</code>.
</p>

<p>
You can use parenthesis to specify <i>captures</i>.
</p>

<p>
When we do a match, ruby automatically populates a series of
global variables which gives access to sub-matches. Those
variables are <code>$1</code>, <code>$2</code>, <code>$3</code> and so on (<code>$0</code> is used to store
the name of the file from which the current program was
initially started up).
</p>

<p>
Witch a <i>MatchData</i> object <code>m</code>. <code>m[0]</code> gives the entire part of
the string that matched. <code>m[1]</code> gives the first capture, <code>m[2]</code>
the second capture etc. Instead of using <code>[]</code> you could use
<code>captures[]</code> where <code>m[1] = m.captures[0]</code>. On your <i>MatchData</i>
object you can use <code>pre_match</code> and <code>post_match</code> to get the
string before and after the match. You can use <code>begin(n)</code> and
<code>end(n)</code> to get the character index where the <code>n</code> math began.
When you perform a successful match operation Ruby always set
the global variable <code>$~</code> to a <i>MatchData</i> object.
</p>

<p>
You can specify names for your captures <code>/(?<i_match_abc>abc)/</code>
and then access them with <code>m[:i_match_abc]</code>.
</p>

<p>
<code>*</code> and <code>+</code> are <i>greedy</i> operators. They match as many
characters as possible.
</p>

<p>
Look-ahead assertions. <code>/\d+(?=\.)/</code> match numbers before a dot.
You have negative look-ahead assertions <code>?!</code> and the
corresponding look-behind assertions <code>?<=</code> and <code>?<!</code>.
</p>

<p>
Conditional matches. <code>(?(1)b|c)</code> matches <code>b</code> if capture number 1
is matched otherwise matches <code>c</code>.
</p>

<p>
Regexp modifiers. <code>/abc/i</code> here the <code>i</code> means case insensitive.
<code>m</code> is for multiline (normally <code>.</code> does not match over lines).
<code>x</code> ignores white-spaces unless escaped. It lets you add comments
in your regular expressions
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-string">/</span>
<span class="org-string">a   #this match a</span>
<span class="org-string">\d+ #this match a number</span>
<span class="org-string">/</span><span class="org-preprocessor">x</span>
</pre>
</div>

<p>
You can perform string interpolation inside a regexp. You can
escape special reg-ex characters inside a string with
<code>Regex.escape</code>.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-string">/abc/</span>
</pre>
</div>

<p>
will print <code>(?-mix:abc)</code> which means <code>m</code>, <code>x</code> and <code>i</code> modifiers
are turned off for regular expression <code>/abc/</code>.
</p>
</div>

<div id="outline-container-sec-21-1" class="outline-3">
<h3 id="sec-21-1"><span class="section-number-3">21.1</span> Common methods</h3>
<div class="outline-text-3" id="text-21-1">
<p>
You can always use match operation as a test in find
operations.
</p>

<ul class="org-ul">
<li><code>scan</code>
Return results in an array. A cool trick is to use scan with
a code bloc. Each match will get sent to the block and then
discarded. Saving memory in the process.
</li>

<li><code>StringScanner</code> provided by <code>strscan</code>
You can move a <i>pointer</i> through the scanned string and move
using <code>pos</code>, <code>peek(n)</code>, <code>unscan</code>, <code>skip</code>, <code>rest</code>
</li>
<li><code>split</code>
You can pass a second argument which limits the number of
items returned
</li>
<li><code>sub</code>, <code>gsub</code> and <code>!</code> versions
<code>sub</code> do only one permutation.

<p>
You can provide a second argument to access parenthetical
captures.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-string">'aDvid'</span>.sub(<span class="org-string">/([a-z])([A-Z])/</span>, <span class="org-string">'\2\1'</span>)
</pre>
</div>

<pre class="example">
David
</pre>
</li>

<li>grep
its uses <code>===</code> implicitly
If you provide a code block you get a combined <i>select/map</i>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-string">%w{ USA UK France Germany }</span>.grep(<span class="org-string">/[a-z]/</span>) { |c| c.upcase }
</pre>
</div>

<table>


<colgroup>
<col  class="left">

<col  class="left">
</colgroup>
<tbody>
<tr>
<td class="left">FRANCE</td>
<td class="left">GERMANY</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-22" class="outline-2">
<h2 id="sec-22"><span class="section-number-2">22</span> File and I/O operations</h2>
<div class="outline-text-2" id="text-22">
<p>
<code>IO</code> handles all input and output by itself or through descendent
like <code>File</code>.
</p>

<p>
<code>STDERR</code>, <code>STDIN</code>, and <code>STDOUT</code> are automatically set when the
program starts. Ruby also gives you three global variables
<code>$stdin</code>, <code>stdout</code>, <code>stderr</code>. You are not supposed to reassign
to the constant but you can reassign to the variable. This gives
you a way to change the default standard I/O stream behaviors
without losing original streams.
</p>

<p>
<code>IO</code> objects iterate based on the global input record separator.
This global input record separator is stored in <code>$/</code> (by default
<i>newline</i>). It you change <code>$/</code> you can change the behavior of
<code>STDIN</code> for example. <code>$/</code> determines the <code>IO</code> object’s sense of
each.
</p>

<p>
You can get keyboard input with <code>gets</code> and <code>getc</code>. With <code>getc</code>
you need to name your input stream explicitly.
</p>

<p>
You can use blocks to economize the hassle to close your file objects.
</p>
</div>

<div id="outline-container-sec-22-1" class="outline-3">
<h3 id="sec-22-1"><span class="section-number-3">22.1</span> Reading files</h3>
<div class="outline-text-3" id="text-22-1">
<ul class="org-ul">
<li><code>gets</code> get a line. <code>nil</code> after end of file. Since
<code>Enumerable</code> is an ancestor you can also use <code>each</code> with a block
</li>
<li><code>readline</code> by lines. <i>Error</i> after end of file
</li>
<li><code>getc</code> gets a character. <code>ungetc(c)</code> replace character just
read with <code>c</code>.
</li>
<li><code>getbyte</code>. Depends on encoding
</li>
<li><code>readchar</code> and <code>readbyte</code> same as <code>getc</code> and <code>getbyte</code> but
raise <i>Error</i> on end of file.
</li>
<li><code>read</code> and <code>readlines</code>
     They take care of opening and closing the file handle for you.
</li>
<li><code>sysseek</code>, <code>sysread</code>, <code>syswrite</code>. Low level <i>I/O</i>.
Un-buffered, don’t mix with higher-level methods.
</li>
</ul>
</div>

<div id="outline-container-sec-22-1-1" class="outline-4">
<h4 id="sec-22-1-1"><span class="section-number-4">22.1.1</span> Internal pointer</h4>
<div class="outline-text-4" id="text-22-1-1">
<p>
You can manipulate it with <code>seek</code> (moves around) and <code>pos</code>
(returns position) and <code>rewind</code> (returns to beginning of file)
</p>

<div class="org-src-container">

<pre class="src src-ruby">f.seek(20, <span class="org-type">IO</span>::<span class="org-type">SEEK_SET</span>) <span class="org-comment-delimiter"># </span><span class="org-comment">to byte 20</span>
f.seek(15, <span class="org-type">IO</span>::<span class="org-type">SEEK_CUR</span>) <span class="org-comment-delimiter"># </span><span class="org-comment">advance 15 byte from current position</span>
f.seek(-10, <span class="org-type">IO</span>::<span class="org-type">SEEK_END</span>) <span class="org-comment-delimiter"># </span><span class="org-comment">10 bytes before end</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-22-2" class="outline-3">
<h3 id="sec-22-2"><span class="section-number-3">22.2</span> Writing to files</h3>
<div class="outline-text-3" id="text-22-2">
<ul class="org-ul">
<li><code>puts</code>. Returns <code>nil</code>.
</li>
<li><code>print</code>. Returns <code>nil</code>.
</li>
<li><code>write</code>. Returns the number of bytes written.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-22-3" class="outline-3">
<h3 id="sec-22-3"><span class="section-number-3">22.3</span> File enumerability</h3>
<div class="outline-text-3" id="text-22-3">
<p>
You can read a whole file into an array (with <code>readline</code>) but it takes memory and
it is usually a bad thing to do.
Instead you can iterate on the file which saves memory.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-type">File</span>.readlines(<span class="org-string">'myfile.txt'</span>).inject(0) {|total, line| <span class="org-comment-delimiter">#</span><span class="org-comment">do stuff} # bad</span>
<span class="org-type">File</span>.open(<span class="org-string">'myfile.text'</span>).inject(0) {|total, line| <span class="org-comment-delimiter">#</span><span class="org-comment">do stuff} # good</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-22-4" class="outline-3">
<h3 id="sec-22-4"><span class="section-number-3">22.4</span> Querying</h3>
<div class="outline-text-3" id="text-22-4">
<p>
Two closely related module and class: <code>File::Stat and
   FileTest</code>. The methods available in <code>File</code> and <code>FileTest</code> are
mostly aliases.
</p>

<ul class="org-ul">
<li>size
<code>File.size('myfile.txt')</code>, <code>FileTest.size('myfile.txt')</code> and <code>FIle::Stat.new('myfile').size</code>
</li>
<li><code>FileTest.exist?</code>
</li>
<li><code>FileTest.directory?</code>
</li>
<li><code>FileTest.file?</code>
</li>
<li><code>FileTest.symlink?</code>
</li>
<li><code>FileTest.readable?</code>, <code>FileTest.writable?</code>,
<code>FileTest.executable?</code>
</li>
</ul>


<p>
<code>File::Stat</code> objects have attributes corresponding to the
standard C library.
</p>

<p>
<code>Kernel</code> has a <code>test</code> method. It can test for files and
directories.
</p>

<div class="org-src-container">

<pre class="src src-ruby">test ?e, <span class="org-string">'/tmp'</span> <span class="org-comment-delimiter">#</span><span class="org-comment">exists?</span>
</pre>
</div>

<p>
Other character to test with are <code>?d</code> for directory, <code>?f</code> for
regular file, <code>?z</code> for zero length file.
</p>
</div>
</div>

<div id="outline-container-sec-22-5" class="outline-3">
<h3 id="sec-22-5"><span class="section-number-3">22.5</span> Directory manipulation</h3>
<div class="outline-text-3" id="text-22-5">
<p>
With the <code>Dir</code> class.
</p>

<ul class="org-ul">
<li><code>Dir.entries</code>
</li>
<li>Globing with <code>Dir[]</code> or <code>Dir.glob</code>. With <code>glob</code> you can give
flag arguments like <code>File::FNM_CASEFOLD</code>, <code>File::FNM_DOTMATCH</code>
</li>
<li><code>mkdir</code>, <code>chdir</code>, <code>rmdir</code>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-22-6" class="outline-3">
<h3 id="sec-22-6"><span class="section-number-3">22.6</span> <code>FileUtils</code></h3>
<div class="outline-text-3" id="text-22-6">
<ul class="org-ul">
<li><code>FileUtils.rm_rf</code>
</li>
<li><code>FileUtils.ln_s</code>
</li>
<li><code>FileUtils.cp</code>
</li>
<li><code>FileUtils.mkdir</code>
</li>
<li><code>FileUtils.mv</code>
</li>
<li><code>FileUtils.rm</code>
</li>
<li><code>FileUtils.rm_rf</code>
</li>
</ul>

<p>
Those methods can be used with <code>FileUtils::DryRun</code> to see the
output of the equivalent unix method call.
</p>

<p>
You can use <code>FileUtils::NoWrite</code> to make sure you don’t
accidentally delete, overwrite or move files.
</p>
</div>
</div>

<div id="outline-container-sec-22-7" class="outline-3">
<h3 id="sec-22-7"><span class="section-number-3">22.7</span> <code>Pathname</code></h3>
<div class="outline-text-3" id="text-22-7">
<ul class="org-ul">
<li><code>basename</code>
</li>
<li><code>dirname</code>
</li>
<li><code>extname</code>
</li>
<li><code>ascend</code> lets you walk up the directory structure with a code
block
<div class="org-src-container">

<pre class="src src-ruby"><span class="org-builtin">require</span> <span class="org-string">'pathname'</span>
<span class="org-type">Pathname</span>.new(<span class="org-type">File</span>.expand_path(<span class="org-string">'~'</span>)).ascend {|x| <span class="org-builtin">puts</span> x }
</pre>
</div>

<pre class="example">
/Users/aurelienbottazzini
/Users
/
</pre>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-22-8" class="outline-3">
<h3 id="sec-22-8"><span class="section-number-3">22.8</span> <code>StringIO</code></h3>
<div class="outline-text-3" id="text-22-8">
<p>
treats string like IO objects. You can see trough them, rewind etc.
</p>
</div>
</div>

<div id="outline-container-sec-22-9" class="outline-3">
<h3 id="sec-22-9"><span class="section-number-3">22.9</span> <code>Tempfile</code></h3>
<div class="outline-text-3" id="text-22-9">
<p>
Useful to run tests
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-type">Tempfile</span>.new(<span class="org-string">'tmp'</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-22-10" class="outline-3">
<h3 id="sec-22-10"><span class="section-number-3">22.10</span> <code>open-uri</code></h3>
<div class="outline-text-3" id="text-22-10">
<p>
Standard <i>HTTP</i> and <i>HTTPS</i> library.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-builtin">require</span> <span class="org-string">'open-uri'</span>
webpage = <span class="org-builtin">open</span>(<span class="org-string">'http://aurelienbottazini.com'</span>)
webpage.gets
</pre>
</div>

<pre class="example">
<!DOCTYPE html>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-23" class="outline-2">
<h2 id="sec-23"><span class="section-number-2">23</span> Object individuation</h2>
<div class="outline-text-2" id="text-23">
<p>
Every object has two classes.
</p>
<ul class="org-ul">
<li>The class of which it’s an instance
</li>
<li>Its singleton class
</li>
</ul>
</div>

<div id="outline-container-sec-23-1" class="outline-3">
<h3 id="sec-23-1"><span class="section-number-3">23.1</span> Singleton classes</h3>
<div class="outline-text-3" id="text-23-1">
<p>
Singleton classes are anonymous, they appear automatically
without being given a name.
</p>

<p>
To get inside the singleton class of an object you use a
special notation.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">class</span> << object
  <span class="org-comment-delimiter"># </span><span class="org-comment">methods and constants definitions</span>
<span class="org-keyword">end</span>
</pre>
</div>

<p>
<code><< object</code> means the anonymous, singleton class of object.
</p>

<p>
There is a difference when you add a method with
<code>obj.some_method</code> and <code>class obj; def some_method</code>: constants.
When you have a top level constants, you can also add a
singleton constant with the same name. <code>obj.some_method</code> can
use the top level one. <code>class obj; def some_method</code> will use
the singleton one.
</p>

<p>
you can think <code>class</code> as either willing to accept a <i>constant</i>
or a  <code><< object</code> expression.
</p>

<p>
You can define class methods with <code><<</code>
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">class</span> <span class="org-type">Ticket</span>
  <span class="org-keyword">class</span> << <span class="org-variable-name">self</span> <span class="org-comment-delimiter">#</span><span class="org-comment">inside the body, same as class << Ticket</span>
    <span class="org-keyword">def</span> <span class="org-function-name">class_method</span>
    <span class="org-keyword">end</span>
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>
</pre>
</div>

<p>
Outside the body of a class you can define the same method with
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">class</span> << <span class="org-type">Ticket</span>
  <span class="org-keyword">def</span> <span class="org-function-name">class_method</span>
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-23-2" class="outline-3">
<h3 id="sec-23-2"><span class="section-number-3">23.2</span> Ancestors</h3>
<div class="outline-text-3" id="text-23-2">
<p>
<code>ancestors</code> is a useful method to look-up the class hierarchy
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">module</span> <span class="org-type">M</span>
<span class="org-keyword">end</span>
<span class="org-keyword">class</span> <span class="org-type">C</span>
<span class="org-keyword">end</span>
c = <span class="org-type">C</span>.new
<span class="org-keyword">class</span> << c
  <span class="org-builtin">include</span> <span class="org-type">M</span>
  <span class="org-builtin">p</span> ancestors
<span class="org-keyword">end</span>
</pre>
</div>

<pre class="example">
[#<Class:#<C:0x007ff4d2895d40>>, M, C, Object, Kernel, BasicObject]
</pre>

<p>
You can refer to the singleton class of an object with the
<code>singleton_class</code> method.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-builtin">puts</span> <span class="org-string">'hello'</span>.singleton_class.ancestors
</pre>
</div>

<pre class="example">
#<Class:#<String:0x007fd452082518>>
String
Comparable
Object
Kernel
BasicObject
</pre>
</div>
</div>

<div id="outline-container-sec-23-3" class="outline-3">
<h3 id="sec-23-3"><span class="section-number-3">23.3</span> Alias</h3>
<div class="outline-text-3" id="text-23-3">
<p>
An alias is a synonym for a method name. By convention when we
create an alias with use <code>__old_method_name__</code> to make an alias
for <code>method_name</code>.
To make an alias you can use <code>alias</code> or <code>alias_method</code>. The
difference is that <code>alias_method</code> takes objects (<i>symbols</i> or
/strings) instead of bare method names.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">alias</span> __old_method method <span class="org-comment-delimiter"># </span><span class="org-comment">no comma</span>
<span class="org-builtin">alias_method</span> <span class="org-constant">:__old_method</span>, <span class="org-constant">:method</span>
</pre>
</div>

<p>
The <code>tap</code> method execute a code block (yielding the receiver to
the block) and returns the receiver.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-builtin">puts</span> <span class="org-string">'hello'</span>.tap {|s| <span class="org-builtin">puts</span> s.upcase }.reverse
</pre>
</div>

<pre class="example">
HELLO
olleh
</pre>
</div>
</div>

<div id="outline-container-sec-23-4" class="outline-3">
<h3 id="sec-23-4"><span class="section-number-3">23.4</span> Modifications</h3>
<div class="outline-text-3" id="text-23-4">
</div><div id="outline-container-sec-23-4-1" class="outline-4">
<h4 id="sec-23-4-1"><span class="section-number-4">23.4.1</span> Additive changes</h4>
<div class="outline-text-4" id="text-23-4-1">
<p>
Danger: two programmer add a method with the same name.
</p>
</div>
</div>

<div id="outline-container-sec-23-4-2" class="outline-4">
<h4 id="sec-23-4-2"><span class="section-number-4">23.4.2</span> Pass-through overrides</h4>
<div class="outline-text-4" id="text-23-4-2">
<p>
The original version of the method end up being called
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">class</span> <span class="org-type">String</span>
  <span class="org-keyword">alias</span> __old_reverse__ reverse

  <span class="org-keyword">def</span> <span class="org-function-name">reverse</span>
    <span class="org-builtin">puts</span> <span class="org-string">'reversing a string!'</span>
    __old_reverse__
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>
<span class="org-builtin">puts</span> <span class="org-string">'hello'</span>.reverse
</pre>
</div>

<pre class="example">
reversing a string!
olleh
</pre>
</div>
</div>

<div id="outline-container-sec-23-4-3" class="outline-4">
<h4 id="sec-23-4-3"><span class="section-number-4">23.4.3</span> Additive/pass-through hybrids</h4>
<div class="outline-text-4" id="text-23-4-3">
<p>
same name, calls the old version and adds something to the
interface. It offers a superset of the functionality of the
original method.
</p>

<p>
For example <i>Active Support</i> allows <code>Time.now.to_s</code> to take an
argument to specify a formatting like <code>Time.now.to_s(:db)</code>
</p>
</div>
</div>

<div id="outline-container-sec-23-4-4" class="outline-4">
<h4 id="sec-23-4-4"><span class="section-number-4">23.4.4</span> Extend</h4>
<div class="outline-text-4" id="text-23-4-4">
<p>
Safest way to add functionality on a strictly per-object basis.
</p>

<p>
You can mix-in modules with <i>extend</i> in objects respective
singleton class on directly on class.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">module</span> <span class="org-type">Secretive</span>
  <span class="org-keyword">def</span> <span class="org-function-name">name</span>
    <span class="org-string">'not available'</span>
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>

<span class="org-keyword">class</span> <span class="org-type">Person</span>
  <span class="org-builtin">attr_accessor</span> <span class="org-constant">:name</span>
<span class="org-keyword">end</span>

david = <span class="org-type">Person</span>.new
david.name = <span class="org-string">'Aurélien'</span>
david.extend(<span class="org-type">Secretive</span>)
<span class="org-builtin">puts</span> david.name
</pre>
</div>

<pre class="example">
not available
</pre>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">module</span> <span class="org-type">Makers</span>
  <span class="org-keyword">def</span> <span class="org-function-name">makes</span>
    <span class="org-string">%w{ Honda Ford Toyota Audi }</span>
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>
<span class="org-keyword">class</span> <span class="org-type">Car</span>
  <span class="org-builtin">extend</span> <span class="org-type">Makers</span>
<span class="org-keyword">end</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-23-4-5" class="outline-4">
<h4 id="sec-23-4-5"><span class="section-number-4">23.4.5</span> Refinements</h4>
<div class="outline-text-4" id="text-23-4-5">
<p>
New in Ruby 2.0. The idea is to make a temporary, limited-scope
change to a class.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">module</span> <span class="org-type">Shout</span>
  <span class="org-builtin">refine</span> <span class="org-type">String</span> <span class="org-keyword">do</span>
    <span class="org-keyword">def</span> <span class="org-function-name">shout</span>
      <span class="org-variable-name">self</span>.upcase + <span class="org-string">'!!!'</span>
    <span class="org-keyword">end</span>
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>

<span class="org-keyword">class</span> <span class="org-type">Person</span>
  <span class="org-builtin">attr_accessor</span> <span class="org-constant">:name</span>

  <span class="org-builtin">using</span> <span class="org-type">Shout</span>

  <span class="org-keyword">def</span> <span class="org-function-name">announce</span>
    <span class="org-builtin">puts</span> <span class="org-string">"I’m </span><span class="org-variable-name">#{name.shout}</span><span class="org-string">"</span>
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>

auray = <span class="org-type">Person</span>.new
auray.name = <span class="org-string">'Aurélien'</span>
<span class="org-builtin">puts</span> auray.announce
</pre>
</div>

<pre class="example">
I’m AURéLIEN!!!
</pre>

<p>
If you use <code>using</code> outside of a class of module, the
refinements persists to the end of the file.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-24" class="outline-2">
<h2 id="sec-24"><span class="section-number-2">24</span> Callable and runnable object</h2>
<div class="outline-text-2" id="text-24">
</div><div id="outline-container-sec-24-1" class="outline-3">
<h3 id="sec-24-1"><span class="section-number-3">24.1</span> Procs</h3>
<div class="outline-text-3" id="text-24-1">
<div class="org-src-container">

<pre class="src src-ruby">pr = <span class="org-type">Proc</span>.new { <span class="org-builtin">puts</span> <span class="org-string">'Inside a proc\'s block'</span> }
pr.call
</pre>
</div>

<p>
The <code>proc</code> method takes a block an returns a <i>Proc</i> object. So
the following two are equivalent.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-builtin">proc</span> { <span class="org-builtin">puts</span> <span class="org-string">'Hi!'</span>}
<span class="org-type">Proc</span>.new { <span class="org-builtin">puts</span> <span class="org-string">'hi!'</span> }
</pre>
</div>

<p>
A <i>proc</i> can serve in place of a code block in a method call
</p>

<div class="org-src-container">

<pre class="src src-ruby">p = <span class="org-builtin">proc</span> {|x| <span class="org-builtin">puts</span> x.upcase }
<span class="org-string">%w{ Aurélien Bottazini }</span>.each(&p)
</pre>
</div>

<p>
A ruby code block is not an object. A code block is part of the
syntax of the method call. A code block is a syntactic construct
and code block aren’t method arguments.
</p>

<p>
Consider:
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">def</span> <span class="org-function-name">capture_block</span>(&block)
  block.call
<span class="org-keyword">end</span>
capture_block { <span class="org-builtin">puts</span> <span class="org-string">'inside a block'</span> }
</pre>
</div>

<pre class="example">
inside a block
</pre>

<p>
Without the special flag <code>&</code>, ruby has no way of knowing that
you want to stop binding parameters and instead perform a
block-to-proc conversion. <code>&</code> also appears the other way around.
i.e use a proc instead of a code block.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">def</span> <span class="org-function-name">capture_block</span>(&block)
  block.call
<span class="org-keyword">end</span>

p = <span class="org-type">Proc</span>.new { <span class="org-builtin">puts</span> <span class="org-string">'inside a block'</span> }
capture_block(&p)
</pre>
</div>

<pre class="example">
inside a block
</pre>

<p>
the <code>&</code> in <code>&p</code> is a wrapper around the method <code>to_proc</code>. Here
<code>&</code> triggers a call to <code>p~’s ~to_proc</code> method and it tells ruby
that the resulting <code>Proc</code> object is serving as a code block
stand-in.
</p>

<p>
You can define <code>to_proc</code> in any class or for any object and the
<code>&</code> technique will then work on affected objects.
</p>

<p>
You can use this built in method <code>&</code> in play for conciseness.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-string">%w{ ruby haskell}</span>.map(&<span class="org-constant">:capitalize</span>)
</pre>
</div>

<table>


<colgroup>
<col  class="left">

<col  class="left">
</colgroup>
<tbody>
<tr>
<td class="left">Ruby</td>
<td class="left">Haskell</td>
</tr>
</tbody>
</table>

<p>
Here <code>:capitalize</code> is interpreted as a message to be sent to
each element of the array in turn.
</p>

<p>
If we try to implement it ourselves:
</p>
<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">class</span> <span class="org-type">Symbol</span>
  <span class="org-keyword">def</span> <span class="org-function-name">to_proc</span>
    <span class="org-type">Proc</span>.new {|obj| obj.send(<span class="org-variable-name">self</span>)}
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>
</pre>
</div>

<p>
The method returns a <code>Proc</code> object that takes one argument and
sends <code>self</code> to that object.
</p>

<p>
One of the most important thing about proc is there service
as closure.
</p>

<p>
When you construct the code block for a call to <code>Proc.new</code>, the
local variables are still in scope.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-variable-name">@a_values</span> = []
<span class="org-keyword">def</span> <span class="org-function-name">calling_proc</span>(pr)
  a = <span class="org-string">'inside calling_proc'</span>
  <span class="org-variable-name">@a_values</span> << a
  pr.call
<span class="org-keyword">end</span>
a = <span class="org-string">'outside calling_proc'</span>
pr = <span class="org-type">Proc</span>.new { <span class="org-variable-name">@a_values</span> << a }
calling_proc(pr)
</pre>
</div>

<table>


<colgroup>
<col  class="left">

<col  class="left">
</colgroup>
<tbody>
<tr>
<td class="left">inside calling<sub>proc</sub></td>
<td class="left">outside calling<sub>proc</sub></td>
</tr>
</tbody>
</table>

<p>
<code>Proc</code> doesn’t care about the number of arguments. Without arguments
it’s single argument is set to <code>nil</code>. With more than one
argument the remaining ones are discarded.
</p>

<p>
<code>lambda</code> returns a <code>Proc</code> object. There is no <code>lambda</code> class.
<code>lambda is like a special ~Proc</code>.
</p>

<p>
<code>return</code> inside a <code>lambda</code> triggers an exit from the body of the
<code>lambda</code>. <code>return</code> inside a <code>proc</code> triggers a return from the
method in which the <code>proc</code> is being executed.
</p>

<p>
<code>lambda</code> proc raise an error when called with the wrong number
of arguments.
</p>

<p>
<code>-></code> also know as stabby lambda is a <code>lambda</code> constructor.
</p>

<div class="org-src-container">

<pre class="src src-ruby">mult = ->(x,y) { x * y }
</pre>
</div>

<pre class="example">
#<Proc:0x007fd1d9169ab0@-:3 (lambda)>
</pre>

<p>
You can use <code>[]</code> which is a synonym for <code>call</code> to call callable
objects
</p>

<div class="org-src-container">

<pre class="src src-ruby">mult = ->(x,y) { x * y }
twelve = mult[3,4]
</pre>
</div>

<pre class="example">
12
</pre>
</div>
</div>

<div id="outline-container-sec-24-2" class="outline-3">
<h3 id="sec-24-2"><span class="section-number-3">24.2</span> Methods as objects</h3>
<div class="outline-text-3" id="text-24-2">
<p>
You can grab a method with the <code>method</code> method.
</p>

<div class="org-src-container">

<pre class="src src-ruby">m = <span class="org-string">'hello'</span>.method(<span class="org-constant">:upcase</span>)
m.call
</pre>
</div>

<pre class="example">
HELLO
</pre>

<p>
You can grab an instance method with <code>instance_method</code>
</p>

<p>
You can <code>unbind</code> a method and <code>bind</code> it again as long as the
two objects are of the same class or subclass.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-25" class="outline-2">
<h2 id="sec-25"><span class="section-number-2">25</span> Eval</h2>
<div class="outline-text-2" id="text-25">
<p>
<code>Binding</code> encapsulates the local variable bindings. There is
also a top-level method <code>binding</code> which returns whatever the
binding is.
The most common use of <code>Binding</code> in the second argument of
<code>eval</code> to provide a given binding to <code>eval</code>.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">def</span> <span class="org-function-name">use_a_binding</span>(b)
  <span class="org-builtin">eval</span>(<span class="org-string">"puts str"</span>, b)
<span class="org-keyword">end</span>

str = <span class="org-string">'I am a string'</span>
use_a_binding(<span class="org-builtin">binding</span>)
</pre>
</div>

<pre class="example">
I am a string
</pre>
</div>

<div id="outline-container-sec-25-1" class="outline-3">
<h3 id="sec-25-1"><span class="section-number-3">25.1</span> <code>instance_eval</code></h3>
<div class="outline-text-3" id="text-25-1">
<p>
Evaluate string or block of code changing <code>self</code> to be the
receiver of <code>instance_eval</code>.
</p>

<p>
Useful to break in another object’s private data.
</p>

<div class="org-src-container">

<pre class="src src-ruby">c.instance_eval { <span class="org-builtin">puts</span> <span class="org-variable-name">@x</span> }
</pre>
</div>

<p>
<code>instance_exec</code> is like <code>instance_eval</code> but it takes a second
argument it can pass as an argument to the code block
</p>

<p>
You can use <code>instance_eval</code> to allow simplified assignment
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">class</span> <span class="org-type">Person</span>
  <span class="org-keyword">def</span> <span class="org-function-name">initialize</span>(&block)
    instance_eval(&block)
  <span class="org-keyword">end</span>

  <span class="org-keyword">def</span> <span class="org-function-name">name</span>(name=<span class="org-variable-name">nil</span>)
    <span class="org-variable-name">@name</span> ||= name
  <span class="org-keyword">end</span>

  <span class="org-keyword">def</span> <span class="org-function-name">age</span>(age=<span class="org-variable-name">nil</span>)
    <span class="org-variable-name">@age</span> ||= age
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>

p = <span class="org-type">Person</span>.new <span class="org-keyword">do</span>
  name <span class="org-string">'Aurélien'</span>
  age 55
<span class="org-keyword">end</span>

<span class="org-builtin">puts</span> p.inspect
</pre>
</div>

<pre class="example">
#<Person:0x007fbe2c06d500 @name="Aurélien", @age=55>
</pre>
</div>
</div>

<div id="outline-container-sec-25-2" class="outline-3">
<h3 id="sec-25-2"><span class="section-number-3">25.2</span> <code>class_eval</code></h3>
<div class="outline-text-3" id="text-25-2">
<p>
It puts you inside a class-definition body
</p>

<div class="org-src-container">

<pre class="src src-ruby">c = <span class="org-type">Class</span>.new
c.class_eval <span class="org-keyword">do</span>
  <span class="org-keyword">def</span> <span class="org-function-name">some_method</span>
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-25-3" class="outline-3">
<h3 id="sec-25-3"><span class="section-number-3">25.3</span> <code>define_method</code></h3>
<div class="outline-text-3" id="text-25-3">
<p>
useful to bring an outer scope variable  into an instance
method
</p>

<div class="org-src-container">

<pre class="src src-ruby">var = <span class="org-string">'hello'</span>
<span class="org-type">C</span>.class_eval { <span class="org-keyword">def</span> talk; <span class="org-builtin">puts</span> var; <span class="org-keyword">end</span> }
</pre>
</div>

<p>
does not work because <code>def</code> creates a new scope.
</p>

<div class="org-src-container">

<pre class="src src-ruby">var = <span class="org-string">'hello'</span>
<span class="org-type">C</span>.class_eval {<span class="org-builtin">define_method</span>(<span class="org-string">'talk'</span>) { <span class="org-builtin">puts</span> var }}
</pre>
</div>

<p>
works because the block keeps the scope.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-26" class="outline-2">
<h2 id="sec-26"><span class="section-number-2">26</span> Threads</h2>
<div class="outline-text-2" id="text-26">
<div class="org-src-container">

<pre class="src src-ruby">t = <span class="org-type">Thread</span>.new <span class="org-keyword">do</span>
  <span class="org-builtin">puts</span> <span class="org-string">'starting'</span>
  <span class="org-builtin">sleep</span> 1
  <span class="org-builtin">puts</span> <span class="org-string">'end'</span>
<span class="org-keyword">end</span>
<span class="org-builtin">puts</span> <span class="org-string">'outside thread'</span>
t.join
</pre>
</div>

<pre class="example">
outside thread
starting
end
</pre>

<p>
Don’t forget to use <code>join</code> to allow the thread to finish
executing (if it takes more time than the remaining of the
program).
</p>

<p>
you can <code>kill</code> or <code>exit</code> or <code>terminate</code> a thread (all synonyms).
</p>

<p>
You can <code>stop</code> and <code>wakeup</code> a <code>Thread</code>. You check its <code>status?</code>,
if it is <code>stop?</code> and <code>alive?</code>.
</p>

<p>
Threads use code blocks and code blocks can see the variables
already created in their local scope. However some globals are
thread-local globals like <code>$1</code>, <code>$2</code> and so on.
</p>

<p>
Threads also have their own variable stash. It let them
associate symbols or strings with values.
</p>

<div class="org-src-container">

<pre class="src src-ruby">t = <span class="org-type">Thread</span>.new <span class="org-keyword">do</span>
  <span class="org-type">Thread</span>.current[<span class="org-constant">:message</span>]  = <span class="org-string">'Hello'</span>
<span class="org-keyword">end</span>
t.join
<span class="org-builtin">p</span> t.keys
<span class="org-builtin">puts</span> t[<span class="org-constant">:message</span>]
</pre>
</div>

<pre class="example">
[:message]
Hello
</pre>
</div>

<div id="outline-container-sec-26-1" class="outline-3">
<h3 id="sec-26-1"><span class="section-number-3">26.1</span> Example chat server using sockets and threads</h3>
<div class="outline-text-3" id="text-26-1">
<div class="org-src-container">

<pre class="src src-ruby"><span class="org-builtin">require</span> <span class="org-string">'socket'</span>
<span class="org-keyword">def</span> <span class="org-function-name">welcome</span>(chatter)
  chatter.print <span class="org-string">'Welcome! enter your name:'</span>
  chatter.readline.chomp
<span class="org-keyword">end</span>

<span class="org-keyword">def</span> <span class="org-function-name">broadcast</span>(message, chatters)
  chatters.each <span class="org-keyword">do</span> |chatter|
    chatter.puts message
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>

s = <span class="org-type">TCPServer</span>.new(3939)
chatters = []

<span class="org-keyword">while</span>(chatter = s.accept)
  <span class="org-type">Thread</span>.new(chatter) <span class="org-keyword">do</span> |c|
    name = welcome(chatter)
    broadcast(<span class="org-string">"</span><span class="org-variable-name">#{name}</span><span class="org-string"> has joined"</span>, chatters)
    chatters << chatter
    <span class="org-keyword">begin</span>
      <span class="org-builtin">loop</span> <span class="org-keyword">do</span>
        line = c. <span class="org-builtin">readline</span>
        broadcast(<span class="org-string">"</span><span class="org-variable-name">#{name}</span><span class="org-string">: </span><span class="org-variable-name">#{line}</span><span class="org-string">"</span>, chatters)
      <span class="org-keyword">end</span>
    <span class="org-keyword">rescue</span> <span class="org-type">EOFError</span>
      c.close
      chatters.delete(c)
      broadcast(<span class="org-string">"</span><span class="org-variable-name">#{name}</span><span class="org-string"> has left"</span>, chatters)
    <span class="org-keyword">end</span>
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-27" class="outline-2">
<h2 id="sec-27"><span class="section-number-2">27</span> Fibers</h2>
<div class="outline-text-2" id="text-27">
<p>
Fibers are like re-entrant code blocks. They can yield back and
forth to their calling context multiple times.
</p>

<div class="org-src-container">

<pre class="src src-ruby">f = <span class="org-type">Fiber</span>.new <span class="org-keyword">do</span>
  <span class="org-builtin">puts</span> <span class="org-string">'hi'</span>
  <span class="org-type">Fiber</span>.yield
  <span class="org-builtin">puts</span> <span class="org-string">'hi again'</span>
  <span class="org-type">Fiber</span>.yield
  <span class="org-builtin">puts</span> <span class="org-string">'last hi'</span>
<span class="org-keyword">end</span>
f.resume
f.resume
f.resume
</pre>
</div>

<pre class="example">
hi
hi again
last hi
</pre>
</div>
</div>

<div id="outline-container-sec-28" class="outline-2">
<h2 id="sec-28"><span class="section-number-2">28</span> System commands</h2>
<div class="outline-text-2" id="text-28">
<p>
With back-ticks <code>``</code> (returns the output and string interpolation) or <code>system</code>.
</p>

<p>
When you use <code>system</code> and <code>``</code>, the global variable <code>$?</code> is set to a
<code>Process::Status</code>, it contains the process ID and its exit
status and it is thread-local
</p>

<p>
A call to nonexistent system method with back-ticks raise a fatal error.
You can also use <code>%x{}</code>. It returns the output and allow string
interpolation.
</p>
</div>

<div id="outline-container-sec-28-1" class="outline-3">
<h3 id="sec-28-1"><span class="section-number-3">28.1</span> <code>open</code> and <code>open3</code></h3>
<div class="outline-text-3" id="text-28-1">
<div class="org-src-container">

<pre class="src src-ruby">d = <span class="org-builtin">open</span>(<span class="org-string">'|cat'</span>, <span class="org-string">'w+'</span>)
d.puts <span class="org-string">'Hi'</span>
d.gets
d.close
</pre>
</div>

<p>
We talk to system command <i>cat</i>. The <code>|</code> indicates we want to
talk to a program and not open a file.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-builtin">require</span> <span class="org-string">'open3'</span>
stdin, stdout, stderr = <span class="org-type">Open3</span>.popen3(<span class="org-string">'cat'</span>)
stdin.puts(<span class="org-string">'Hi.\nBye.'</span>)
stdout.gets
stdout.gets
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-29" class="outline-2">
<h2 id="sec-29"><span class="section-number-2">29</span> Callbacks, hooks and run-time introspection</h2>
<div class="outline-text-2" id="text-29">
<p>
<i>callbacks</i> and <i>hooks are used for meta-programming. They
activate on /events</i>.
</p>

<p>
An event can be something like:
</p>

<ul class="org-ul">
<li>A nonexistent method called on an object
</li>
<li>An object being extended by a module
</li>
<li>A class being sub-classed
</li>
<li>An instance method added to a class
</li>
<li>A nonexistent module called on an object
</li>
</ul>
</div>


<div id="outline-container-sec-29-1" class="outline-3">
<h3 id="sec-29-1"><span class="section-number-3">29.1</span> <code>method_missing</code></h3>
<div class="outline-text-3" id="text-29-1">
<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">def</span> <span class="org-function-name">method_missing</span>(m, *args, &block)
  <span class="org-builtin">raise</span> <span class="org-type">NameError</span>, <span class="org-string">"what do you mean by </span><span class="org-variable-name">#{m}</span><span class="org-string">"</span>
<span class="org-keyword">end</span>
</pre>
</div>

<p>
We redefined <code>method_missing</code> at the top level. Making it a
private instance of method <code>Object</code>. Thus it is available for
all objects except instances of <code>BasicObject</code>.
</p>

<p>
<code>method_missing</code> and <code>respond_to?</code> don’t play well together. If
you create methods dynamically inside <code>method_missing</code> but
<code>respond_to?</code> will still say they don’t exist. To go around
that problem you can implement <code>respond_to_missing?</code>
</p>

<p>
Here is an example
</p>
<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">def</span> <span class="org-function-name">method_missing</span>(m, *args, &block)
  <span class="org-keyword">if</span> <span class="org-string">/set_(.)/</span>.match(m)
    <span class="org-comment-delimiter">#</span><span class="org-comment">respond to message</span>
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>

<span class="org-keyword">def</span> <span class="org-function-name">respond_to_missing?</span>(m, include_private = <span class="org-variable-name">false</span>)
  <span class="org-string">/set_/</span>.match(m) || <span class="org-keyword">super</span>
<span class="org-keyword">end</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-29-2" class="outline-3">
<h3 id="sec-29-2"><span class="section-number-3">29.2</span> prepend and include</h3>
<div class="outline-text-3" id="text-29-2">
<p>
You can define special methods called <code>included</code> and <code>prepended</code>
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">module</span> <span class="org-type">M</span>
  <span class="org-keyword">def</span> <span class="org-variable-name">self</span>.<span class="org-function-name">included</span>(c)
    <span class="org-builtin">puts</span> <span class="org-string">"mixed into </span><span class="org-variable-name">#{c}</span><span class="org-string">"</span>
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>

<span class="org-keyword">class</span> <span class="org-type">C</span>
  <span class="org-builtin">include</span> <span class="org-type">M</span>
<span class="org-keyword">end</span>
</pre>
</div>

<pre class="example">
mixed into C
</pre>

<p>
You can even add class methods with this technique
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">module</span> <span class="org-type">M</span>
  <span class="org-keyword">def</span> <span class="org-variable-name">self</span>.<span class="org-function-name">included</span>(c)
    <span class="org-keyword">def</span> c.<span class="org-function-name">a_class_method</span>
    <span class="org-keyword">end</span>
  <span class="org-keyword">end</span>

  <span class="org-keyword">def</span> <span class="org-function-name">an_inst_method</span>
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-29-3" class="outline-3">
<h3 id="sec-29-3"><span class="section-number-3">29.3</span> extended</h3>
<div class="outline-text-3" id="text-29-3">
<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">module</span> <span class="org-type">M</span>
  <span class="org-keyword">def</span> <span class="org-variable-name">self</span>.<span class="org-function-name">extended</span>(obj)
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-29-4" class="outline-3">
<h3 id="sec-29-4"><span class="section-number-3">29.4</span> intercepting inheritance</h3>
<div class="outline-text-3" id="text-29-4">
<p>
With <code>inherited</code>
</p>
<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">class</span> <span class="org-type">C</span>
  <span class="org-keyword">def</span> <span class="org-variable-name">self</span>.<span class="org-function-name">inherited</span>(subclass)
    <span class="org-builtin">puts</span> <span class="org-string">"</span><span class="org-variable-name">#{self}</span><span class="org-string"> inherited from </span><span class="org-variable-name">#{subclass}</span><span class="org-string">"</span>
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>
<span class="org-keyword">class</span> <span class="org-type">D</span> < <span class="org-type">C</span> <span class="org-comment-delimiter"># </span><span class="org-comment">triggers inherited</span>
<span class="org-keyword">end</span>
<span class="org-keyword">class</span> <span class="org-type">E</span> < <span class="org-type">D</span> <span class="org-comment-delimiter"># </span><span class="org-comment">triggers inherited</span>
<span class="org-keyword">end</span>
</pre>
</div>

<pre class="example">
C inherited from D
D inherited from E
</pre>

<p>
<code>inherited</code> is a class method so it defines an <code>inherited</code>
cascade. <code>inherited</code> does not work on singleton class.
</p>
</div>
</div>

<div id="outline-container-sec-29-5" class="outline-3">
<h3 id="sec-29-5"><span class="section-number-3">29.5</span> <code>const_missing</code></h3>
<div class="outline-text-3" id="text-29-5">
<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">class</span> <span class="org-type">C</span>
  <span class="org-keyword">def</span> <span class="org-variable-name">self</span>.<span class="org-function-name">const_missing</span>(const)
    const_set(const, 1)
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>

<span class="org-builtin">puts</span> <span class="org-type">C</span>::<span class="org-type">UNKNOWN</span>
</pre>
</div>

<pre class="example">
1
</pre>
</div>
</div>

<div id="outline-container-sec-29-6" class="outline-3">
<h3 id="sec-29-6"><span class="section-number-3">29.6</span> <code>method_added</code></h3>
<div class="outline-text-3" id="text-29-6">
<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">class</span> <span class="org-type">C</span>
  <span class="org-keyword">def</span> <span class="org-variable-name">self</span>.<span class="org-function-name">method_added</span>(m)
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-29-7" class="outline-3">
<h3 id="sec-29-7"><span class="section-number-3">29.7</span> listing methods</h3>
<div class="outline-text-3" id="text-29-7">
<p>
With <code>methods</code> you can list the non-private methods of the
object itself. You don’t get the methods from <i>mix-ins</i> for
examples. It can take an argument, if you set it to false you
won’t get methods from ancestors.
</p>

<p>
<code>private_methods</code> list private methods
<code>protected_methods</code> list protected methods
<code>singleton_methods</code> list singleton methods
</p>

<p>
You can do <code>methods.grep(/methods/).sort</code> to find a detailing
listing of your possibilities.
</p>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-builtin">puts</span> <span class="org-type">Object</span>.methods.grep(<span class="org-string">/methods/</span>).sort
</pre>
</div>

<pre class="example">
instance_methods
methods
private_instance_methods
private_methods
protected_instance_methods
protected_methods
public_instance_methods
public_methods
singleton_methods
</pre>
</div>
</div>

<div id="outline-container-sec-29-8" class="outline-3">
<h3 id="sec-29-8"><span class="section-number-3">29.8</span> instropection</h3>
<div class="outline-text-3" id="text-29-8">
<ul class="org-ul">
<li><code>local_variables</code> list local variables. Inside irb you will
see <code>[:_]</code>. It is a special irb variable. It represents the
value of the last expression evaluated by irb.
</li>

<li><code>global_variables</code> list global variables
</li>
<li><code>instance_variables</code> list instance variables
</li>
<li><code>caller</code> provides an array of strings representing the
stack-trace

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-keyword">def</span> <span class="org-function-name">z</span>
  <span class="org-builtin">puts</span> <span class="org-builtin">caller</span>
<span class="org-keyword">end</span>
z
</pre>
</div>

<pre class="example">
-:4:in `<main>'
</pre>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Aurélien Bottazini</p>
<p class="date">Created: 2014-11-20 Thu 10:57</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.4.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
